<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title></title>
    </head>
    <body>
        <h1>Audit Database for Datical Projects</h1>
        <p />
        <div class="toc-macro client-side-toc-macro  conf-macro output-block">
        </div>
        <p>The audit database records Datical operations and status. You can use a single audit database for all projects, or use multiple audit databases, one for each organizational unit.&#160;</p>
        <p>Datical Service uses the audit database to report operations statistics in the <a href="Viewing_the_Dashboard.htm">Dashboard</a>.&#160;</p>
        <p>Datical operations log records in the audit database:</p>
        <ul>
            <li>Package</li>
            <li>Status</li>
            <li>Forecast</li>
            <li>Deploy</li>
            <li>Rollback</li>
            <li>Changelog Synch</li>
            <li>Others</li>
        </ul>
        <h1 id="AuditDatabaseforDaticalProjects-CreatingtheAuditDatabase">Creating the Audit Database</h1>
        <p>Identify a database location for the audit database (for example DATICAL_AUDITDB). It should be separate from all managed databases. All Datical DB installations and automations must have network access to it.&#160;</p>
        <p>The database can be any supported type. It does not have to match the database type used as managed databases in release pipelines.&#160;</p>
        <h1 id="AuditDatabaseforDaticalProjects-CreatinganAuditDatabaseUser">Creating an Audit Database User</h1>
        <p>You can have all projects use the same user to access the audit database, for example DATICAL_AUDIT_USER.&#160;</p>
        <p>Create the user and password. If other users are creating Datical projects, they need those credentials to configure a connection from their project to the audit database.&#160;</p>
        <h1 class="auto-cursor-target" id="AuditDatabaseforDaticalProjects-CreatingandAssigningAuditDatabaseRoles">Creating and Assigning Audit Database Roles</h1>
        <p>Create a role that has the necessary permissions for accessing the audit database (for example DATICAL_AUDIT_ROLE), then assign the role to the common audit database user (example DATICAL_AUDIT_USER).&#160;</p>
        <h2 id="AuditDatabaseforDaticalProjects-PermissionsNeededfortheAuditDatabase">Permissions Needed for the Audit Database</h2>
        <p>The audit database logs entries and other information when project operations are run. In general, the following permissions are needed. See the sections for each database type.&#160;</p>
        <ul>
            <li><span style="color: rgb(51,51,51);">create table</span>
            </li>
            <li><span style="color: rgb(51,51,51);">create index</span>
            </li>
            <li><span style="color: rgb(51,51,51);">create constraints </span>
            </li>
            <li><span style="color: rgb(51,51,51);">drop table</span>
            </li>
            <li><span style="color: rgb(51,51,51);">read table</span>
            </li>
            <li><span style="color: rgb(51,51,51);">delete from table</span>
            </li>
        </ul>
        <h2 class="auto-cursor-target" id="AuditDatabaseforDaticalProjects-DB2Databases">DB2 Databases</h2>
        <p>The database configuration must be set for table organization by row.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">update db cfg using dft_table_org row</pre>
            </div>
        </div>
        <p>
            <br />
        </p>
        <p>The following example creates role DATICAL_AUDIT_ROLE and grants permissions to it.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE ROLE DATICAL_AUDIT_ROLE;

# add permissions here</pre>
            </div>
        </div>
        <h2 class="auto-cursor-target" id="AuditDatabaseforDaticalProjects-OracleDatabases">Oracle Databases</h2>
        <p>The following example creates role DATICAL_AUDIT_ROLE and grants permissions to it.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>DATICAL_AUDIT_ROLE in Oracle</b>
            </div>
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE ROLE DATICAL_AUDIT_ROLE NOT IDENTIFIED;

GRANT CONNECT TO DATICAL_AUDIT_ROLE;
GRANT RESOURCE TO DATICAL_AUDIT_ROLE;</pre>
            </div>
        </div>
        <h2 class="auto-cursor-target" id="AuditDatabaseforDaticalProjects-EDBPostgresDatabases">EDB Postgres Databases</h2>
        <p>The following example creates role DATICAL_AUDIT_ROLE and grants permissions to it.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE ROLE DATICAL_AUDIT_ROLE;

# add permissions here</pre>
            </div>
        </div>
        <h2 class="auto-cursor-target" id="AuditDatabaseforDaticalProjects-SQLServerDatabases">SQL Server Databases</h2>
        <p>The following example creates role datical_audit_user and grants permissions to it.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">USE [DATICAL_AUDITDB]
GO
CREATE USER [datical_audit_user] FOR LOGIN [datical_login]
GO
EXEC sp_addrolemember N'db_ddladmin', N'datical_audit_user'
GO
EXEC sp_addrolemember N'db_datareader', N'datical_audit_user'
GO
EXEC sp_addrolemember N'db_datawriter', N'datical_audit_user'
GO
GRANT VIEW DATABASE STATE to [datical_audit_user]
GO
ALTER SERVER ROLE [dbcreator] ADD MEMBER [datical_audit_user]
GO</pre>
            </div>
        </div>
        <h1 id="AuditDatabaseforDaticalProjects-InitializingtheAuditDatabase">Initializing the Audit Database</h1>
        <p>The Datical DB GUI allows you to configure the audit database when you create a project. Enter the database location and user credentials to use in the <strong>Settings</strong> tab,&#160;&#160;<strong>Audit DB</strong> section.&#160;&#160;</p>
        <ul>
            <li>When an audit database is configured for the first time, Datical DB creates the required schema for it.</li>
            <li>After the audit database is configured or identified for the project, each project that&#160;uses it must configure an Audit Database connection using the database name, user, and password.&#160;</li>
        </ul>
        <p>See&#160;<a href="Configuring_a_Project_to_Use_the_Audit_Database.htm">Configuring a Project to Use the Audit Database</a>.</p>
    </body>
</html>