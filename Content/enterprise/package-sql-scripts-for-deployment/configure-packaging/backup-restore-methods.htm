<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title>Liquibase Enterprise Documentation</title><meta name="description" content="Liquibase Enterprise Documentation" /></head>
    <body>
        <h1>Custom Backup and Restore Methods</h1> <MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" /><p>During packaging, the REF database is backed up and restored. Deployment Packager uses common backup and restore operations supported by each database.&#160;&#160;</p><p>To use another method, you can write a custom backup and restore class in a Groovy script and configure Deployment Packager use it.&#160;</p><h1 id="CustomBackupandRestoreMethods-Overview">Overview</h1> <MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" /><p>To implement a custom backup and restore class, do the following:</p><ol><li><p>Write the class - Use the provided sample scripts as a starting point and write a custom script. In the script, write a class with methods for backup and restore. Place it in the default location or a custom location.&#160;</p><p class="title">Note</p><p>The Groovy script name and the class name should use the same name. Use the naming convention <code>BackupRestore&lt;dbname&gt;&lt;name&gt;.&#160;</code></p><p>Example:&#160; <code>BackupRestoreOracleCustom.groovy</code> should contain class <code>BackupRestoreOracleCustom</code>.&#160;</p></li><li>Test the class - Use the provided test script to test the custom script outside of Deployment Packager.&#160;</li><li>Configure Deployment Packager - Use new properties in <code>deployPackager.properties</code> to have Deployment Packager use the custom script.&#160;<ul><li style="margin-left: 0.0px;"><code>databaseBackupRestoreMethod</code>&#160;</li><li style="margin-left: 0.0px;"><code>extensionsPath</code></li></ul></li><li>Test the class again. Run Deployment Packager manually with test scripts.&#160;</li></ol><h1 id="CustomBackupandRestoreMethods-WritingaCustomScript">Writing a Custom Script</h1> <MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" /><p>To provide a custom backup and restore method to use, do the following:</p><ol><li>Implement a custom class inside a groovy script. Two example scripts are provided:<ul><li style="margin-left: 0.0px;"><code>BackupRestoreOracleCustom.groovy</code> - This script is a copy of the default backup and restore script that Deployment Packager uses for Oracle. It uses Oracle's&#160;<code>expdp</code> and <code>impdp</code> command-line tools.&#160;</li><li style="margin-left: 0.0px;"><code>BackupRestoreCustomStub.groovy</code> - A mostly-empty stub script with comments. It runs successfully in the test script but performs no actions.&#160;</li></ul></li><li>Place the groovy script where you want it.<ul><li style="margin-left: 0.0px;">The default location for custom scripts is&#160;<code>&lt;datical-install&gt;/repl/scripts/extensions</code>.&#160;&#160;</li><li style="margin-left: 0.0px;"><span style="color: rgb(0,0,10);">If you place the custom script in another location, you&#160;<span style="color: rgb(0,0,10);">can set the property&#160;<span style="color: rgb(23,43,77);"><code>extensionsPath </code>in <code>deployPackager.properties</code></span></span>&#160;</span></li></ul></li></ol><h1 class="auto-cursor-target" id="CustomBackupandRestoreMethods-TestingaCustomScript">Testing a Custom Script</h1> <MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" /><p>Use the provided test script to test your custom script without running Deployment Packager.</p><p><code>&lt;datical-install&gt;/repl/scripts/database_backup_restore.groovy</code></p><p>To get help on the script, run it without any arguments.&#160;</p><p>Specify a DbDef (for the database to work on) plus any other arguments that you have implemented.&#160;</p><pre class="syntaxhighlighter-pre" xml:space="preserve">hammer groovy database_backup_restore.groovy &lt;dbdef&gt; [backup | restore]</pre><h2 id="CustomBackupandRestoreMethods-BackupTest">Backup Test</h2><p>The backup test follows these steps:</p><ol><li>Checks the settings<span>&#160;<code>database</code></span><code>backupRestoreMethod</code>and<code>databaseBackupRestoreLocation</code>.&#160;&#160;</li><li>Checks the DbDef</li><li>Runs a backup and reports status (success, failure)</li><li>Reports final status (success, failure)</li></ol><h2 id="CustomBackupandRestoreMethods-RestoreTest">Restore Test</h2><p>The restore test requires a prior backup. It follows these steps:</p><ol><li>Checks the settings<span>&#160;<code>database</code></span><code>backupRestoreMethod</code>and<code>databaseBackupRestoreLocation</code>.&#160;&#160;</li><li>Checks the DbDef</li><li>Runs a restore and reports status (success, failure)</li><li>Reports final status (success, failure)</li></ol><h2 id="CustomBackupandRestoreMethods-CustomizingtheTestScript">Customizing the Test Script</h2><p>Copy and edit the provided test script. Add other tests to the script as you need.&#160;</p><h1 id="CustomBackupandRestoreMethods-ConfiguringDeploymentPackager">Configuring Deployment Packager</h1> <MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" /><p>See&#160;<a href="required-deploy-packager-properties.htm">Using the Required deployPackager.properties File</a>.&#160;</p><p>Add properties to&#160;<code>&lt;project&gt;/deployPackager.properties</code>:</p><ul><li><p>&#160;<code>databaseBackupRestoreMethod&#160;</code>- Required. The name of the custom class. It should match the Groovy script name (without the <code>.groovy</code> extension).&#160;</p><pre class="syntaxhighlighter-pre" xml:space="preserve">databaseBackupRestoreMethod=BackupRestoreOracleMyCustom</pre></li><li><p><span style="color: rgb(0,0,10);"><code><span style="color: rgb(0,0,10);">extensionsPath&#160;</span></code></span>- Optional. If you place the custom Groovy script in a location other than the default &#160;<code>&lt;datical-install&gt;/repl/scripts/extensions</code>, then set this property.&#160;</p><pre class="syntaxhighlighter-pre" xml:space="preserve">extensionsPath=C:\\Datical\\DaticalDB\\DaticalCustomExtensions</pre></li></ul><h1 id="CustomBackupandRestoreMethods-ExampleScripts">Example Scripts</h1> <MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" /><p>Example scripts are provided in&#160;<code><span style="color: rgb(0,0,10);">&lt;datical-install&gt;/repl/scripts/extensions</span></code></p><ul><li><span style="color: rgb(0,0,10);"><code>BackupRestoreCustomStub.groovy</code> is a stub that can be used as a starting point for a custom backup restore implementation. </span></li><li><span style="color: rgb(0,0,10);"><code>BackupRestoreOracleCustom.groovy</code> is an example of a working implementation.</span></li></ul></body>
</html>