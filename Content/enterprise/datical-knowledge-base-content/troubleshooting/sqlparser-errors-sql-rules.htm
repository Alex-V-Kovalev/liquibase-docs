<?xml version="1.0" encoding="utf-8"?>
<html>
    <head><title></title>
    </head>
    <body>
        <h1>Troubleshooting: SqlParser errors in SQL Rules for existing previously working rules after upgrading to v6.15 or later</h1>
        <h2 id="Troubleshooting:SqlParsererrorsinSQLRulesforexistingpreviouslyworkingrulesafterupgradingtov6.15orlater-Problem">Problem</h2>
        <div class="confluence-information-macro confluence-information-macro-information conf-macro output-block">
            <div class="confluence-information-macro-body">
                <p>SQL Rules no longer work AND you see an error such as liquibase.util.StringClauses$QuotedIdentifier cannot be cast to java.lang.String</p>
            </div>
        </div>
        <p>The SQLRules that used to work previously no longer work and the SQLRule is using the SqlParser class then the problem may be fixed by following the solution details below.</p>
        <h2 id="Troubleshooting:SqlParsererrorsinSQLRulesforexistingpreviouslyworkingrulesafterupgradingtov6.15orlater-Solution">Solution</h2>
        <p>If the rule contains the use of the internal class SqlParser, the objects returned have changed slightly to return objects that need to call the toString() method directly.</p>
        <p />
        <p>If the SQL Rule looks something like this:</p>
        <p>function boolean selectAndJoinWithoutNolock(String sqlString) {<br />    int selectCount = 0;<br />    int nolockCount = 0;<br />    List&lt;String&gt; lines = new ArrayList&lt;&gt;();<br />    StringClauses parsed = SqlParser.parse(sqlString, true, false);<br />    ClauseIterator ci = parsed.getClauseIterator(); //<br />// Parse out the tokens into a List for later processing<br />//<br />    while (ci.hasNext()) {<br /><strong>String string = (String)ci.nextNonWhitespace();</strong><br />        if (string != null) {<br />            lines.add(string);<br />        }<br />    } …</p>
        <p>Change it to something like this<br /></p>
        <p>function boolean selectAndJoinWithoutNolock(String sqlString) {<br />    int selectCount = 0;<br />    int nolockCount = 0;<br />    List&lt;String&gt; lines = new ArrayList&lt;&gt;();<br />    StringClauses parsed = SqlParser.parse(sqlString, true, false);<br />    ClauseIterator ci = parsed.getClauseIterator(); //<br />// Parse out the tokens into a List for later processing<br />//<br />    while (ci.hasNext()) {<br /><strong>Object obj = ci.nextNonWhitespace();</strong><br /><strong>if (obj != null) {</strong><br /><strong>            lines.add(obj.toString());</strong><br /><strong>        }</strong><br />    } …</p>
        <p />
        <h2 id="Troubleshooting:SqlParsererrorsinSQLRulesforexistingpreviouslyworkingrulesafterupgradingtov6.15orlater-Relatedarticles">Related articles</h2>
        <p />
        <ul class="content-by-label conf-macro output-block">
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="Troubleshooting__Unable_to_execute__datical_edbplus_sh__v__.htm">Troubleshooting: Unable to execute "datical_edbplus.sh -v".</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="#">Troubleshooting: SqlParser errors in SQL Rules for existing previously working rules after upgrading to v6.15 or later</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="Troubleshooting__DaticalDB_GUI_Installation_with_only_OpenJDK_installed.htm">Troubleshooting: DaticalDB GUI Installation with only OpenJDK installed</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="Troubleshooting__Datical_GUI_on_Windows_10_hangs_on_the_splash_screen_and_takes_a_couple_of_minutes_to_load.htm">Troubleshooting: Datical GUI on Windows 10 hangs on the splash screen and takes a couple of minutes to load</a>
                </div>
            </li>
        </ul>
    </body>
</html>