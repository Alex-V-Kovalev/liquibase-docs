<?xml version="1.0" encoding="utf-8"?>
<html>
    <head><title></title>
    </head>
    <body>
        <h1>Roles and Permissions for <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> and Azure SQL Database</h1> <MadCap:snippetText src="../../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /><div class="toc-macro client-side-toc-macro  conf-macro output-block"></div><p>See <a class="external-link" href="http://datical-cs.atlassian.net/wiki/spaces/DDOC/pages/896566728/Database+Users%2C+Roles%2C+and+Passwords" rel="nofollow">Database Users, Roles, and Passwords</a> for a general database setup for <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />.&#160;</p><div class="confluence-information-macro confluence-information-macro-information conf-macro output-block"><div class="confluence-information-macro-body"><p>The Datical Packager process requires elevated privileges on a REF Azure SQL Database as an ephemeral database is created and dropped as part of the Backup and Restore operations. The below instructions show how to setup separate Logins and Users for a REF database versus a non-REF database.</p></div></div><h1 id="RolesandPermissionsforDaticalDBandAzureSQLDatabase-CreateaREFDaticalLoginandUser">Create a REF Datical Login and User</h1> <MadCap:snippetText src="../../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /><p>Make sure that you are connected to the <code>master</code> database as the Server admin and use the <code>master</code> database to run commands:</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 680.0px;" /></colgroup><tbody><tr><td class="confluenceTd"><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE LOGIN [datical_ref_login] WITH PASSWORD=N'&lt;password&gt;';
CREATE USER [datical_ref_user] FOR LOGIN [datical_ref_login];
EXEC sp_addrolemember 'dbmanager', 'datical_ref_user';</pre></div></div></td></tr></tbody></table></div><p>The dbmanager role is a Server-level role required for managing and creating databases. Additionally, if the Datical User needs the ability to create and manage logins, include the following role:</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 680.0px;" /></colgroup><tbody><tr><td class="confluenceTd"><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">EXEC sp_addrolemember 'loginmanager', 'datical_ref_user';</pre></div></div></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-information conf-macro output-block"><div class="confluence-information-macro-body"><p>The default Azure password complexity rules are the following: minimum length of 8 characters, minimum of 1 uppercase character, minimum of 1 lowercase character, minimum of 1 number.</p></div></div><h1 id="RolesandPermissionsforDaticalDBandAzureSQLDatabase-CreateaREFDatabaseUser">Create a REF Database User</h1> <MadCap:snippetText src="../../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /><p>Create a user (<code>datical_ref_user</code>) for a database where Packager operation will be performed:</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 184.0px;" /><col style="width: 234.0px;" /><col style="width: 345.0px;" /></colgroup><tbody><tr><th class="confluenceTh"><p>Role/Permission</p></th><th class="confluenceTh"><p>When is this required?</p></th><th class="confluenceTh"><p>Permissions</p></th></tr><tr><td class="confluenceTd"><p><strong>db_owner</strong></p></td><td class="confluenceTd"><p>This role is required for REF databases and the Packager process to create an ephemeral copy of the database during Backup and Restore.</p></td><td class="confluenceTd"><p>Manage fixed-database role membership, configuration, and maintenance activities.</p></td></tr><tr><td class="confluenceTd"><p><strong>VIEW DATABASE STATE</strong></p></td><td class="confluenceTd"><p>This is required for some Datical operations such as using Approximate Row Counts.</p></td><td class="confluenceTd"><p>Read data from dynamic management views scoped to the database.</p></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-information conf-macro output-block"><div class="confluence-information-macro-body"><p>You must be connected to the database instance you want to use with <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> while granting permissions.</p></div></div><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 680.0px;" /></colgroup><tbody><tr><td class="confluenceTd"><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE USER [datical_ref_user] FOR LOGIN [datical_ref_login];
EXEC sp_addrolemember 'db_owner', 'datical_ref_user';</pre></div></div></td></tr></tbody></table></div><h1 id="RolesandPermissionsforDaticalDBandAzureSQLDatabase-Createanon-REFDaticalLoginandUser">Create a non-REF Datical Login and User</h1> <MadCap:snippetText src="../../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /><p>Make sure that you are connected to the <code>master</code> database as the Server admin and use the <code>master</code> database to run commands:</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 680.0px;" /></colgroup><tbody><tr><td class="confluenceTd"><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE LOGIN [datical_login] WITH PASSWORD=N'&lt;password&gt;';
CREATE USER [datical_user] FOR LOGIN [datical_login];</pre></div></div></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-information conf-macro output-block"><div class="confluence-information-macro-body"><p>The default Azure password complexity rules are the following: minimum length of 8 characters, minimum of 1 uppercase character, minimum of 1 lowercase character, minimum of 1 number.</p></div></div><h1 id="RolesandPermissionsforDaticalDBandAzureSQLDatabase-Createanon-REFDatabaseUser">Create a non-REF Database User</h1> <MadCap:snippetText src="../../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /><p>Create a user (<code>datical_user</code>) for database where Forecast and Deploy (not Packager) operations will be performed:</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 184.0px;" /><col style="width: 234.0px;" /><col style="width: 345.0px;" /></colgroup><tbody><tr><th class="confluenceTh"><p>Role/Permission</p></th><th class="confluenceTh"><p>When is this required?</p></th><th class="confluenceTh"><p>Permissions</p></th></tr><tr><td class="confluenceTd"><p><strong>db_ddladmin &#160;</strong></p></td><td class="confluenceTd"><p>This is required if you do not connect as the database owner.</p></td><td class="confluenceTd"><p>Run any Data Definition Language (DDL) command in a database.</p></td></tr><tr><td class="confluenceTd"><p><strong>db_datawriter</strong></p></td><td class="confluenceTd"><p>This is required if you do not connect as the database owner.</p></td><td class="confluenceTd"><p>Add, delete, or change data in all user tables.</p></td></tr><tr><td class="confluenceTd"><p><strong>db_datareader</strong></p></td><td class="confluenceTd"><p>This is required if you do not connect as the database owner.</p></td><td class="confluenceTd"><p>Read all data from all user tables.</p></td></tr><tr><td class="confluenceTd"><p><strong>VIEW DATABASE STATE</strong></p></td><td class="confluenceTd"><p>This is required for some Datical operations such as using Approximate Row Counts.</p></td><td class="confluenceTd"><p>Read data from dynamic management views scoped to the database.</p></td></tr></tbody></table></div><div class="confluence-information-macro confluence-information-macro-information conf-macro output-block"><div class="confluence-information-macro-body"><p>You must be connected to the database instance you want to use with <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> while granting permissions.</p></div></div><div class="table-wrap"><table class="confluenceTable"><colgroup><col style="width: 680.0px;" /></colgroup><tbody><tr><td class="confluenceTd"><div class="code panel pdl conf-macro output-block" style="border-width: 1px;"><div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">CREATE USER [datical_user] FOR LOGIN [datical_login];
EXEC sp_addrolemember 'db_ddladmin', 'datical_user';
EXEC sp_addrolemember 'db_datawriter', 'datical_user';
EXEC sp_addrolemember 'db_datareader', 'datical_user';</pre></div></div></td></tr></tbody></table></div><p /><p /><p /></body>
</html>