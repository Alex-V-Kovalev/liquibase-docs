<?xml version="1.0" encoding="utf-8"?>
<html>
    <head><title></title>
    </head>
    <body>
        <h1>Roles and Permissions for <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> on DB2 LUW</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p />
        <div class="toc-macro client-side-toc-macro  conf-macro output-block">
        </div>
        <p>See <a href="../../../../zz_sandbox/Enterprise Documentation/datical-db-documentation/configure-databases-for-datical-db-release-pipelines/Configuring-Databases-for-Datical-DB-Release-Pipelines/Database_Users__Roles__and_Passwords.htm">Database Users, Roles, and Passwords</a> for a general discussion of database setup for <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />.&#160;</p>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-Prerequisite">Prerequisite</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>DB2 managed databases should be configured for Oracle compatibility mode before you can use Datical to forecast and deploy stored logic objects and/or to use the Stored Logic Validity Check feature. See <a class="external-link" href="https://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.apdv.porting.doc/doc/t0054729.html" rel="nofollow">IBM documentation</a>.&#160;<br /><br />$ su - db2inst1<br />$ db2start<br />$ db2set DB2_COMPATIBILITY_VECTOR=ORA<br />$ db2set DB2_DEFERRED_PREPARE_SEMANTICS=YES<br />$ db2stop<br />$ db2start</p>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-Role-BasedPrivilegesforServiceUser">Role-Based Privileges for Service User</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p><MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> does not require special privileges above and beyond what is required to create, alter, and drop the most common database object types that support your database applications. There are two common implementation patterns for configuring <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> access schemes in DB2: granting privileges to the Datical Role and granting privileges to a single Datical User.</p>
        <h2 id="RolesandPermissionsforDaticalDBonDB2LUW-GrantingPrivilegestoaDaticalRole">Granting Privileges to a Datical Role</h2>
        <p>Granting privileges to a Datical Role is typically chosen in environments where individual team members will use unique credentials to access the database through <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />.&#160; This simplifies the privilege management process by centralizing where GRANTS &amp; REVOKES are performed.&#160; The role is then assigned to the user accounts that require database access with <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />.</p>
        <h2 id="RolesandPermissionsforDaticalDBonDB2LUW-GrantingPrivilegestoaDedicatedDaticalDBUser(ServiceUser)">Granting Privileges to a Dedicated <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> User (Service User)</h2>
        <p>Granting privileges to a dedicated Datical User allows an organization to drastically reduce the number of individuals with access to the database password.&#160; Because the database password is encoded in <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />, an administrator may create <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> projects and share them with <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> users.&#160; The <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> users can then perform database change tasks without having access to the database password.&#160;&#160;<em style="text-align: left;"><strong>We strongly recommend to use runtime credentials because it is more secure than stored credentials (due to the possibility of the stored password being decoded)</strong></em><span style="color: rgb(9,30,66);">.</span></p>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-PrivilegesforManagedDatabases">Privileges for Managed Databases</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>To validate and automate database deployments <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> needs to be able to connect to a database and to perform routine CREATE, ALTER, &amp; DROP statements in the appropriate schema.</p>
        <p>
            <br />
        </p>
        <ul>
            <li><strong>Database Privileges</strong>
                <ul>
                    <li>CONNECT<ul><li>Grants the authority to access the database.</li></ul></li>
                    <li>SQLADM<ul><li>Grants&#160;<span style="color: rgb(50,50,50);">the authority required to monitor and tune SQL statements. (Recommended for roles on the reference database to report on active connections that cause the backup and restore operations to fail).</span></li></ul></li>
                </ul>
            </li>
            <li><strong>Schema Privileges&#160;</strong><em>(use “<strong>with grant option</strong>” if user/role needs to grant permissions to other users/roles)</em>
            </li>
        </ul>
        <ul>
            <li style="list-style-type: none;background-image: none;">
                <ul>
                    <li>CREATEIN<ul><li>Grants the privilege to create objects in the schema. Other authorities or privileges required to create the object (such as CREATETAB) are still required. The owner of an explicitly created schema automatically receives CREATEIN privilege. An implicitly created schema has CREATEIN privilege automatically granted to PUBLIC.</li></ul></li>
                    <li>ALTERIN<ul><li>Grants the privilege to alter or comment on all objects in the schema. The owner of an explicitly created schema automatically receives ALTERIN privilege.</li></ul></li>
                    <li>DROPIN<ul><li>Grants the privilege to drop all objects in the schema. The owner of an explicitly created schema automatically receives DROPIN privilege.</li></ul></li>
                    <li>WITH GRANT OPTION (so the user can grant permissions to other users/roles)<ul style="margin-left: 0.0px;"><li>Allows the specified&#160;<em>authorization-name</em>s to GRANT privileges to others.<ul style="margin-left: 0.0px;"><li>Schema level CREATEIN, ALTERIN, DROPIN With Grant Option must be granted to the user for the schema. This will ensure the user has the privilege to grant permissions for any <strong>newly created objects</strong>.</li><li><strong>To manage permissions for existing objects</strong>, the following privileges must be granted (<a class="external-link" href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_9.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000966.html" rel="nofollow">https://www.ibm.com/support/knowledgecenter/en/SSEPGG_9.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000966.html</a>)<ul><li>Object level CREATEIN, ALTERIN, DROPIN With Grant Option&#160;must be granted to the user for the appropriate objects on the database, or</li><li><div>Object level CONTROL privilege must be granted to the user for the appropriate objects on the database</div></li></ul></li></ul></li></ul></li>
                </ul>
            </li>
            <li><strong>Data Privileges</strong>
                <ul>
                    <li>DATAACCESS (<a class="external-link" href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_11.1.0/com.ibm.db2.luw.admin.sec.doc/doc/c0053934.html" rel="nofollow">https://www.ibm.com/support/knowledgecenter/en/SSEPGG_11.1.0/com.ibm.db2.luw.admin.sec.doc/doc/c0053934.html</a>)<ul><li>Access and update data in user tables, views, and materialized query tables in a DB2 subsystem</li><li>Execute plans, packages, functions, and procedures.</li><li>Select privilege on all system catalog tables and views.</li></ul></li>
                </ul>
            </li>
            <li><strong>Tablespace Access</strong>
                <ul>
                    <li>GRANT USE OF TABLESPACE &lt;tablespace_name&gt; TO ROLE &lt;role_name&gt;<ul><li>Provides access to the desired tablespace&#160;</li></ul></li>
                </ul>
            </li>
        </ul>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-PrivilegesfortheREFDatabase">Privileges for the REF Database</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>You must have SYSADM, SYSCTRL, or SYSMAINT authority to use the backup utility which is required by the Datical Packager.</p>
        <p>This permission is only needed on user accounts involved in packaging changes in the REF databases. It is not needed in any of the other databases in the environment.</p>
        <p><span>Steps to setup DB2 on Linux user with SYSADM authority:</span>
        </p>
        <div class="expand-container conf-macro output-block" id="expander-1883597250">
            <div id="expander-control-1883597250" class="expand-control"><span class="expand-control-text">Click here to expand...</span>
            </div>
            <div id="expander-content-1883597250" class="expand-content expand-hidden">
                <ol>
                    <li>Create user, e.g., datical_user using these steps:<ol><li>Log in as root to the computer with IDM DB installed. To create a local user (linux limit up to and including 8 chars), at a command prompt, type the following command:<br /><span style="color: rgb(255,102,0);"><code>useradd DATDB_USER</code></span><br /><span style="color: rgb(255,102,0);"><code>passwd DATDB_USER</code></span></li></ol></li>
                    <li>
                        <p>Identify the SYSADM group by typing the following command:<br /><span style="color: rgb(255,102,0);"><code>db2 get dbm cfg | grep group</code></span></p>
                        <ol>
                            <li>
                                <p>Output may look like this: <br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="700" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896566780/image2019-10-14_20-21-56.png?version=1&amp;modificationDate=1571103882877&amp;cacheVersion=1&amp;api=v2&amp;width=700&amp;height=89" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896566780/image2019-10-14_20-21-56.png?version=1&amp;modificationDate=1571103882877&amp;cacheVersion=1&amp;api=v2&amp;width=1066&amp;height=136 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896566780/image2019-10-14_20-21-56.png?version=1&amp;modificationDate=1571103882877&amp;cacheVersion=1&amp;api=v2&amp;width=700&amp;height=89 1x" /></span></p>
                            </li>
                            <li>
                                <p>Notice "db2iadm1" is listed as SYSADM group. You need to add user "DATDB_USER" to this group at the OS level (in Linux)</p>
                            </li>
                            <li>
                                <p>Log in as root to the computer with IBM DB2 installed.<br /><span style="color: rgb(255,102,0);"><code>usermod -a -G db2iadm1 DATDB_USER</code></span></p>
                            </li>
                        </ol>
                    </li>
                </ol>
            </div>
        </div>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-PermissionsneededtoperformGRANTS">Permissions needed to perform GRANTS</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>To perform grants - if you don't use the "WITH GRANT OPTIONS" on CREATEIN/ALTERIN/DROPIN or grant CONTROL, you will also need to grant&#160;<span style="color: rgb(0,0,0);">ACCESSCTRL as documented in&#160;<a class="external-link" href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.1.0/com.ibm.db2.luw.admin.sec.doc/doc/c0053933.html" rel="nofollow">https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.1.0/com.ibm.db2.luw.admin.sec.doc/doc/c0053933.html</a>.</span></p>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-Example:CreatingaRoletoContainPrivileges">Example: Creating a Role to Contain Privileges</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>In the following example you create the DATDB_ROLE, and grant privileges to it, then grant the DATDB_ROLE to user DATDB_USER.&#160;</p>
        <p>
            <br />
        </p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">-- Create the role ‘DATDB_ROLE’ and grant the ‘CONNECT’ privilege for the DB to be managed
CREATE ROLE DATDB_ROLE
GRANT CONNECT ON DATABASE TO ROLE DATDB_ROLE
-- If the database is a reference database used in packaging, grant the 'SQLADM' privilege to monitor active connections during backup and retore
GRANT SQLADM ON DATABASE TO ROLE DATDB_ROLE
 
-- Grant ‘ALTERIN’,’CREATEIN’ &amp; ‘DROPIN’ privileges to ‘DATDB_ROLE’ for the desired schema
--
-- “with grant option” can be optionally added to the following statements if the role needs
-- to grant permissions to other users/roles
GRANT ALTERIN ON SCHEMA MYAPPSCHEMA TO ROLE DATDB_ROLE WITH GRANT OPTION
GRANT CREATEIN ON SCHEMA MYAPPSCHEMA TO ROLE DATDB_ROLE WITH GRANT OPTION
GRANT DROPIN ON SCHEMA MYAPPSCHEMA TO ROLE DATDB_ROLE WITH GRANT OPTION
-- To be able to grant permissions to existing objects, you will need to either
--   Provide object level CREATEIN, ALTERIN, DROPIN With Grant Option privileges, or
--   Provide object level CONTROL privilege
-- to the DATDB_ROLE
GRANT ALTERIN, CREATEIN, DROPIN ON TABLE1 TO ROLE DATDB_ROLE WITH GRANT OPTION
--GRANT CONTROL ON TABLE1 TO ROLE DATDB_ROLE WITH GRANT OPTION
-- Grant data access on a database to a specific role
GRANT DATAACCESS ON DATABASE TO ROLE DATDB_ROLE
 
-- Grant tablespace access to role
GRANT USE OF TABLESPACE &lt;tablespace_name&gt; TO ROLE DATDB_ROLE
 
-- Grant the role ‘DATDB_ROLE’ to user ‘DATDB_USER’
GRANT ROLE DATDB_ROLE TO USER DATDB_USER</pre>
            </div>
        </div>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-Example:GrantingPrivilegesDirectlytoaUser">Example: Granting Privileges Directly to a User</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>In this example you create user DATDB_USER and grant privileges directly to the user.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">-- Grant the ‘CONNECT’ privilege for the DB to be managed
GRANT CONNECT ON DATABASE TO USER DATDB_USER
 
-- Grant ‘ALTERIN’,’CREATEIN’ &amp; ‘DROPIN’ privileges to ‘DATDB_ROLE’ for the desired schema
--
-- “with grant option” can be optionally added to the following statements if the user needs
-- to grant permissions to other users/roles
GRANT ALTERIN ON SCHEMA MYAPPSCHEMA TO USER DATDB_USER WITH GRANT OPTION
GRANT CREATEIN ON SCHEMA MYAPPSCHEMA TO USER DATDB_USER WITH GRANT OPTION
GRANT DROPIN ON SCHEMA MYAPPSCHEMA TO USER DATDB_USER WITH GRANT OPTION
-- To be able to grant permissions to existing objects, you will need to either
--   Provide object level CREATEIN, ALTERIN, DROPIN With Grant Option privileges, or
--   Provide object level CONTROL privilege
-- to the DATDB_USER
GRANT ALTERIN, CREATEIN, DROPIN ON TABLE1 TO ROLE DATDB_USER WITH GRANT OPTION
--GRANT CONTROL ON TABLE1 TO ROLE DATDB_USER WITH GRANT OPTION
-- Grant data access on a database to a specific role
GRANT DATAACCESS ON DATABASE TO USER DATDB_USER
 
-- Grant tablespace access to role
GRANT USE OF TABLESPACE &lt;tablespace_name&gt; TO USER DATDB_USER</pre>
            </div>
        </div>
        <h1 id="RolesandPermissionsforDaticalDBonDB2LUW-Example:ViewingUserPermissions">Example: Viewing User Permissions</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p>The following example shows two ways to view privileges for user DATDB_USER.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">-- Retrieve database permissions for user DATDB_USER
select * from SYSCAT.DBAUTH  where GRANTEE = 'DATDB_USER'
-- Retrieve privilege granted to DATDB_USER along with the object name, schema, and type
SELECT * FROM SYSIBMADM.PRIVILEGES WHERE AUTHIDTYPE = 'U' AND AUTHID = 'DATDB_USER'</pre>
            </div>
        </div>
    </body>
</html>