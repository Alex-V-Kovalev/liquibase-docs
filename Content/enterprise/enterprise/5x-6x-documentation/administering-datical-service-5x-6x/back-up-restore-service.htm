<?xml version="1.0" encoding="utf-8"?>
<html>
    <head><title></title>
    </head>
    <body>
        <h1>Backing Up and Restoring Datical Service</h1>
        <p />
        <div class="toc-macro client-side-toc-macro  conf-macro output-block"></div>
        <p>You should perform a regular backup of Datical Service in parallel with the databases it manages.&#160;</p>
        <p>The following facilities are backed up:</p>
        <ul>
            <li>postgres - The PostgreSQL database installed as part of Datical Service. It contains data for the application database and the audit database.<ul><li><strong>Note</strong>: if you use an external database for the audit database, you must back it up separately. Datical Service does not provide backups for it.&#160;</li></ul></li>
            <li>internal-client - The user data stored in the Jenkins internal client.&#160;</li>
        </ul>
        <h1 id="BackingUpandRestoringDaticalService-VersionRequirements">Version Requirements</h1>
        <p>You may backup and restore only from an an installation of the same version.&#160;&#160;</p>
        <p>You can transport a backup of one version to a fresh installation of the same version and restore it there.&#160;</p>
        <p>
            <br />
        </p>
        <div class="confluence-information-macro confluence-information-macro-information conf-macro output-block">
            <p class="title">Important</p>
            <div class="confluence-information-macro-body">
                <p>You cannot restore a backup of one version to any other version.&#160;</p>
            </div>
        </div>
        <p>
            <br />
        </p>
        <h1 id="BackingUpandRestoringDaticalService-BackingUpDaticalService">Backing Up Datical Service</h1>
        <p>Use the following CLI command to back up all services.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">datical-control backup all</pre>
            </div>
        </div>
        <h2 id="BackingUpandRestoringDaticalService-BackingUpSelectedComponents">Backing Up Selected Components</h2>
        <p>You can also back up the following components individually by using an alternate option on the command line:&#160;</p>
        <ul>
            <li><strong>postgresql</strong> - Backs up the PostgreSQL application database</li>
            <li><strong>internal-client</strong> - Backs up user data stored in the internal client service (Jenkins).&#160;</li>
        </ul>
        <p>They are included when you use <code>backup all</code>.&#160;</p>
        <h2 id="BackingUpandRestoringDaticalService-BackupLocation">Backup Location&#160;</h2>
        <p>Manual backups are stored in set directories using a timestamped file name pattern. Examples:</p>
        <div class="preformatted panel conf-macro output-block" style="border-width: 1px;">
            <div class="preformattedContent panelContent"><pre xml:space="preserve">/opt/datical/data-clustered/backup/all/datical-service-all-2018-10-23_18-29.bak
/opt/datical/data-clustered/backup/postgresql/datical-service-postgresql-2018-10-23_18-29.bak
/opt/datical/data-clustered/backup/jenkins/datical-internal-client-2018-10-23_18-29.bak</pre>
            </div>
        </div>
        <p>
            <br />
        </p>
        <div class="confluence-information-macro confluence-information-macro-information conf-macro output-block">
            <p class="title">Note</p>
            <div class="confluence-information-macro-body">
                <p>Backups in the&#160;<code>all</code>&#160;directory come only from manual backups.&#160;&#160;</p>
                <p>The <code>postgresql</code> and <code>jenkins</code> directories contain automated backups and any manual backups you perform. See Auto-Backup.&#160;</p>
            </div>
        </div>
        <h2 id="BackingUpandRestoringDaticalService-BackupFileLimits">Backup File Limits</h2>
        <p>Only the last 10 backups are retained in the <code>postgresql</code> and <code>jenkins</code> directories. Older backups are discarded as new backups are made.&#160;</p>
        <p>There is no limit on backups kept in the <code>all</code> directory.&#160;</p>
        <h1 id="BackingUpandRestoringDaticalService-RestoringDaticalService">Restoring Datical Service</h1>
        <p>Use the following command to restore backup files.&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">sudo datical-control restore [all | postgresql | internal-client] --file &lt;filename&gt;</pre>
            </div>
        </div>
        <p class="auto-cursor-target">You may specify the absolute path or the path from the current working directory.&#160;</p>
        <h1 class="auto-cursor-target" id="BackingUpandRestoringDaticalService-Auto-Backup">Auto-Backup</h1>
        <p>To perform auto-backup, cron jobs run at 12:00 am, 6:00 am, and 6:00 pm. They cannot be changed or turned off.&#160;</p>
        <p>They perform the following backups:</p>
        <ul>
            <li><strong>postgresql</strong> - PostgreSQL application database</li>
            <li><strong>internal-client</strong> - User data stored in the internal client service (Jenkins).&#160;</li>
        </ul>
        <p>Auto-backup uses the same directory and file pattern that manual backups use.&#160;</p>
        <div class="preformatted panel conf-macro output-block" style="border-width: 1px;">
            <div class="preformattedContent panelContent"><pre xml:space="preserve">/opt/datical/data-clustered/backup/postgresql/datical-service-postgresql-2018-10-23_18-29.bak
/opt/datical/data-clustered/backup/jenkins/datical-internal-client-2018-10-23_18-29.bak</pre>
            </div>
        </div>
        <h1 id="BackingUpandRestoringDaticalService-DisasterRecoveryandBackupStorage">Disaster Recovery and Backup Storage</h1>
        <p>You should provide tools or processes for moving backup files to an offsite location so they are available for disaster recovery.&#160;</p>
        <p>We recommend that you back up the following directory in coordination with your offline backup processes. It contains all automated and manual backups.&#160;</p>
        <div class="preformatted panel conf-macro output-block" style="border-width: 1px;">
            <div class="preformattedContent panelContent"><pre xml:space="preserve">/opt/datical/data-clustered/backup/
</pre>
            </div>
        </div>
    </body>
</html>