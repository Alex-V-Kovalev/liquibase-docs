<?xml version="1.0" encoding="utf-8"?>
<html>
    <head><title></title>
    </head>
    <body>
        <h1>How To: Deploy Changes to a Specific Environment<MadCap:snippetText src="../../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /></h1>
        <hr />
        <p>
            <br />
        </p>
        <p>There are certain changes that only need to be deployed to one or few environments instead of deploying to every environment. For example, deploy changes to QA only (or STAGE only or PROD only).&#160;</p>
        <p>Using <a href="deploy-changes-specific-environment.htm">metadata.properties</a> and the use of "context" help us achieve this goal. A "context" refers to a specific database (or databases) in the pipeline. When a Datical pipeline is configured, each connection to database is given a context. This context can be used to perform deployments.&#160;</p>
        <p><span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border image-center" height="213" width="770" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_15-44-2.png?version=1&amp;modificationDate=1502829844376&amp;cacheVersion=1&amp;api=v2&amp;width=770&amp;height=213" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_15-44-2.png?version=1&amp;modificationDate=1502829844376&amp;cacheVersion=1&amp;api=v2&amp;width=770&amp;height=213 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_15-44-2.png?version=1&amp;modificationDate=1502829844376&amp;cacheVersion=1&amp;api=v2&amp;width=770&amp;height=213 1x" /></span>
        </p>
        <h2 id="HowTo:DeployChangestoaSpecificEnvironment-WheredoyouspecifycontextforadatabaseenvironmentinDaticalproject?">Where do you specify context for a database environment in Datical project?</h2>
        <ul>
            <li>In <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> GUI, click on "Edit Connection" link for each database in the project:</li>
            <li><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" width="275" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-9-42.png?version=1&amp;modificationDate=1502829975370&amp;cacheVersion=1&amp;api=v2&amp;width=275&amp;height=342" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-9-42.png?version=1&amp;modificationDate=1502829975370&amp;cacheVersion=1&amp;api=v2&amp;width=326&amp;height=406 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-9-42.png?version=1&amp;modificationDate=1502829975370&amp;cacheVersion=1&amp;api=v2&amp;width=275&amp;height=342 1x" /></span>
            </li>
            <li>Specify context here. If no context is provided, click on the "Configure" button on the right to type in the context</li>
            <li><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" height="466" width="440" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-11-47.png?version=1&amp;modificationDate=1502830365424&amp;cacheVersion=1&amp;api=v2&amp;width=440&amp;height=465" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-11-47.png?version=1&amp;modificationDate=1502830365424&amp;cacheVersion=1&amp;api=v2&amp;width=614&amp;height=650 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-11-47.png?version=1&amp;modificationDate=1502830365424&amp;cacheVersion=1&amp;api=v2&amp;width=440&amp;height=465 1x" /></span>&#160;→&#160;<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" width="490" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-13-53.png?version=1&amp;modificationDate=1502830365707&amp;cacheVersion=1&amp;api=v2&amp;width=490&amp;height=318" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-13-53.png?version=1&amp;modificationDate=1502830365707&amp;cacheVersion=1&amp;api=v2&amp;width=633&amp;height=412 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-2_11-13-53.png?version=1&amp;modificationDate=1502830365707&amp;cacheVersion=1&amp;api=v2&amp;width=490&amp;height=318 1x" /></span></li>
            <li>Click "OK".</li>
            <li>Repeat for all database environments in the project, including database environments in other pipelines that exist in the project.<ul><li>Your context can match your database name as shown in the table below:<ul><li><div class="table-wrap"><table class="wrapped confluenceTable"><colgroup><col /><col /></colgroup><tbody><tr><th class="confluenceTh">Database name</th><th class="confluenceTh">Context</th></tr><tr><td class="confluenceTd">REF1</td><td class="confluenceTd">REF1</td></tr><tr><td class="confluenceTd">DEV</td><td class="confluenceTd">DEV</td></tr><tr><td colspan="1" class="confluenceTd">QA</td><td colspan="1" class="confluenceTd">QA</td></tr><tr><td colspan="1" class="confluenceTd">STAGE</td><td colspan="1" class="confluenceTd">STAGE</td></tr><tr><td colspan="1" class="confluenceTd">PROD</td><td colspan="1" class="confluenceTd">PROD</td></tr></tbody></table></div></li></ul></li></ul></li>
            <li>Finally, make sure to push the project into your SCM (e.g., Bitbucket).</li>
        </ul>
        <h2 id="HowTo:DeployChangestoaSpecificEnvironment-Step-by-stepguide">Step-by-step guide</h2>
        <ol>
            <li>Setup directory structure such that there are context-specific subdirectories in EACH of the sql_code directories (data_dml, ddl, ddl_direct, function, package, packagebody, procedure, sql, sql_direct, trigger, and view)<ul><li>For example, in data_dml directory, there would be three DEV directories - one for each DEV environment - DEV1, DEV2 and DEV3</li><li><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" width="250" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_15-57-44.png?version=1&amp;modificationDate=1502830666754&amp;cacheVersion=1&amp;api=v2&amp;width=250&amp;height=331" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_15-57-44.png?version=1&amp;modificationDate=1502830666754&amp;cacheVersion=1&amp;api=v2&amp;width=330&amp;height=437 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_15-57-44.png?version=1&amp;modificationDate=1502830666754&amp;cacheVersion=1&amp;api=v2&amp;width=250&amp;height=331 1x" /></span></li><li>In each of the subdirectories, there would be a "metadata.properties" file which would contain "contexts" flag:<ul><li>In <u>PROD-only</u> subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">PROD</span>"</li><li>In&#160;<u>STAGE-only</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">STAGE</span>"</li><li>In&#160;<u>QA-only</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">QA</span>"</li><li>In&#160;<u>DEV-only</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">DEV</span>"</li><li>In&#160;<u>REF1-only</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">REF1</span>"</li><li>In <u>until-DEV</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">REF1,DEV</span>"</li><li>In&#160;<u>until-QA</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">REF1,DEV,QA</span>"</li><li>In <u>until-STAGE</u>&#160;subdirectory, the "metadata.properties" file would contain "contexts=<span style="color: rgb(255,102,0);">REF1,DEV,QA,STAGE</span>"</li></ul></li></ul></li>
            <li>Database developer commits scripts into the appropriate subdirectory.&#160;<br /><ul><li>For example, if a DML script only needs to be deployed into QA environment, then the developer would commit that scripts into the following subdirectory:<ul><li>sql_code&#160;→ data_dml&#160;→ QA-only</li><li><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" width="600" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_16-6-36.png?version=1&amp;modificationDate=1502831197742&amp;cacheVersion=1&amp;api=v2&amp;width=600&amp;height=233" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_16-6-36.png?version=1&amp;modificationDate=1502831197742&amp;cacheVersion=1&amp;api=v2&amp;width=716&amp;height=279 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_16-6-36.png?version=1&amp;modificationDate=1502831197742&amp;cacheVersion=1&amp;api=v2&amp;width=600&amp;height=233 1x" /></span></li></ul></li></ul></li>
            <li>When the packager picks up scripts from this subdirectory (e.g., sql_code\data_dml\QA-only), it will automatically apply the "QA" context to resulting changsets.<br /><ul><li>Let's say "customer_billing_SEPT.sql" script is committed into&#160;sql_code\data_dml\QA-only subdirectory</li><li>When packager runs, it will pick up this script and realize that there is a metadata.properties file located in the same subdirectory and it contains contexts=QA. Therefore, packager will apply this context to all changesets generated from this sql script</li><li><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-content-image-border" width="1000" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_16-43-18.png?version=1&amp;modificationDate=1502833399598&amp;cacheVersion=1&amp;api=v2&amp;width=1000&amp;height=79" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_16-43-18.png?version=1&amp;modificationDate=1502833399598&amp;cacheVersion=1&amp;api=v2&amp;width=1199&amp;height=95 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/1441818/image2017-8-15_16-43-18.png?version=1&amp;modificationDate=1502833399598&amp;cacheVersion=1&amp;api=v2&amp;width=1000&amp;height=79 1x" /></span></li><li>Now, when you deploy your changes to QA environment, these changesets will be DEPLOYED.</li><li>When you deploy your changes to other environments (DEV, STAGE or PROD), these changesets will be SKIPPED because the context for these changesets do not match with the database context as specified in the Datical project.</li></ul></li>
        </ol>
        <p>
            <br />
        </p>
        <div class="confluence-information-macro confluence-information-macro-information conf-macro output-block">
            <div class="confluence-information-macro-body">
            </div>
        </div>
        <h2 id="HowTo:DeployChangestoaSpecificEnvironment-Relatedarticles">Related articles</h2>
        <p />
        <p />
        <ul class="content-by-label conf-macro output-block">
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="deploy-changes-specific-environment.htm">How To: Remove abandonded changes from Datical and lower environments</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="deploy-changes-specific-environment.htm">How To: Abandon a Single Changeset from a Script</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="#">How To: Deploy Changes to a Specific Environment</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="deploy-changes-specific-environment.htm">How To: Leverage the "metadata.properties" file</a>
                </div>
            </li>
            <li>
                <div><span class="icon aui-icon aui-icon-small aui-iconfont-page-default" title="Page">Page:</span>
                </div>
                <div class="details"><a href="deploy-changes-specific-environment.htm">How To: Execute scripts with different content depending on the environment</a>
                </div>
            </li>
        </ul>
        <p>
            <br />
        </p>
        <p>
            <br />
        </p>
    </body>
</html>