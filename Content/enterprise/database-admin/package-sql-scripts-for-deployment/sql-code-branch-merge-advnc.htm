<?xml version="1.0" encoding="utf-8"?>
<html>
    <head><title></title>
    </head>
    <body>
        <h1>SQL Code Branching &amp; Merging (Advanced)</h1>
        <p />
        <div class="toc-macro client-side-toc-macro  conf-macro output-block">
        </div>
        <h1 id="SQLCodeBranching&amp;Merging(Advanced)-Introduction">Introduction</h1>
        <p>To support development of database application across concurrent releases or to support Continuous Delivery lifecycles, application teams often manage the source code of their applications across several branches of the same source code control repository. This allows individual developers and teams to better control when their changes and additions are released and when they accept changes from other developers or teams that are working on a different feature or release in the same application. To incorporate changes from another source, an application team will merge the source code files from the branch in which they were created to the branch in which the new changes are needed.</p>
        <p>To support these branching practices the Deployment Packager can detect when SQL scripts are merged into the SQL code repository, locate existing Change Sets associated with the merged scripts and modify the Change Sets' labels and contexts settings so they can be deployed in a new pipeline or environment.</p>
        <h1 id="SQLCodeBranching&amp;Merging(Advanced)-AssociatingChangeSetswithSQLScriptMerges">Associating ChangeSets with SQL Script Merges</h1>
        <p>In order to identify the change sets that were previously generated by a merged script, the Deployment Packager will now assign a 'scriptChecksum' attribute to each Change Set it introduces when the Packager is run in SCM Mode. The value of the attribute is a checksum that is based on the contents of the script that generated them. &#160;This checksum safeguards against unintended script modification or duplicate name use by ensuring that the script that was merged matches the script that was used to generate the Change Sets. <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="84" width="688" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddav15f275949ace6f8c595f60d771b695ca.png?version=1&amp;modificationDate=1569858669395&amp;cacheVersion=1&amp;api=v2&amp;width=688&amp;height=84" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddav15f275949ace6f8c595f60d771b695ca.png?version=1&amp;modificationDate=1569858669395&amp;cacheVersion=1&amp;api=v2&amp;width=688&amp;height=84 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddav15f275949ace6f8c595f60d771b695ca.png?version=1&amp;modificationDate=1569858669395&amp;cacheVersion=1&amp;api=v2&amp;width=688&amp;height=84 1x" /></span></p>
        <h1 id="SQLCodeBranching&amp;Merging(Advanced)-MergeApproaches">Merge Approaches</h1>
        <p>The Deployment Packager can be configured to manage source code merges in two ways: <em>Concurrent Pipeline Merging &amp; Feature Merging.</em></p>
        <h2 id="SQLCodeBranching&amp;Merging(Advanced)-ConcurrentPipelineMerging">Concurrent Pipeline Merging</h2>
        <p>When an application development group is split into multiple teams working on separate planned releases, they often perform source code merges across branches that are tied to distinct pipelines established for each release. A pipeline is a chain of environments in which software is developed, tested, staged and released. After a team's release occurs, they will merge the branch for their pipeline into the branches associated with other teams' planned releases. This allows the other teams to better plan and execute their own development as changes are made to production.</p>
        <p>The diagram below illustrates the flow of database changes for a group that is split into three teams, each working in its own pipeline on a separate release. Each pipeline terminates in the production environment. When development is complete and the new features and fixes from a pipeline are released to the production database, the branch in which those changes were developed and tested are merged into the branches associated with future releases.<br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="335" width="672" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddave9510d2bd38b146fde42e04ef8912266.png?version=1&amp;modificationDate=1569858669032&amp;cacheVersion=1&amp;api=v2&amp;width=672&amp;height=334" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddave9510d2bd38b146fde42e04ef8912266.png?version=1&amp;modificationDate=1569858669032&amp;cacheVersion=1&amp;api=v2&amp;width=900&amp;height=448 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddave9510d2bd38b146fde42e04ef8912266.png?version=1&amp;modificationDate=1569858669032&amp;cacheVersion=1&amp;api=v2&amp;width=672&amp;height=334 1x" /></span><br />When the Deployment Packager detects that a SQL script has been merged into the source code control branch associated with a pipeline, it will search for Change Sets with matching script names and scriptChecksum values. When matches are found, the <strong>label</strong> for the new pipeline is added to those Change Sets which makes them available for Deployment on the new pipeline.</p>
        <p>To configure your project to take advantage of Concurrent Pipeline Merge mode, configure pipeline-specific branch properties in the deployPackager.properties file as described in&#160;<a href="../../DDOC59/pages/Using_the_required_deployPackager_properties_file.htm">Using the required deployPackager.properties file</a>.&#160;&#160;Once configured, the detection and handling of merged scripts should occur automatically when the Deploy Packager is run in SCM mode.</p>
        <h3 id="SQLCodeBranching&amp;Merging(Advanced)-DbDefLabelRequirementsforPipelineMerges">DbDef Label Requirements for Pipeline Merges</h3>
        <p>Each DbDef must have the pipeline name as the first label in order for pipeline merges to succeed.&#160;</p>
        <h2 id="SQLCodeBranching&amp;Merging(Advanced)-FeatureBasedMerging">Feature Based Merging</h2>
        <p>Feature merges must merge existing changesets only. Do not attempt to package new changes during a merge.&#160;</p>
        <p>Feature Based Merge mode is designed to support development activities where source code control branches are associated with specific environments within a pipeline. In this mode the merge activity represents the opening of a deployment gate between environments in the lifecycle. Consider the following automated development process:</p>
        <ul>
            <li>A development team using a Feature Based Merge strategy has three environments: DEV, QA, &amp; <span class="inline-comment-marker">PROD.</span></li>
            <li>Each environment maps to a GIT branch:<ul><li>DEV -&gt; IN_WORK</li><li>UAT -&gt; READY_FOR_TEST</li><li>RELEASE -&gt; RELEASE_APPROVED</li></ul></li>
            <li>Each environment/branch combo has a Jenkins job associated with it that builds and deploys the application from the branch tied to that environment.</li>
            <li>When a developer merges the files that provide a feature into the 'READY_FOR_TEST' branch of the source code repository, that developer is indicating that the feature is dev complete and should be deployed to the UAT environment.</li>
            <li>Jenkins detects the merge into the READY_FOR_TEST branch and starts the job that builds from that branch and deploys to the <span class="inline-comment-marker">QA environment</span>.</li>
            <li>A similar merge into the RELEASE_APPROVED source code control branch triggers the build and deploy to the RELEASE environment for that feature.</li>
        </ul>
        <p>Unlike Concurrent Pipeline Merge mode where a group of features are merged after a release, the merges in Feature Based Merge mode precede the release of functionality to the next environment in the pipeline.<br /><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="365" width="672" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddav71106afedf2e50eb7e4bf715019bf3c1.png?version=1&amp;modificationDate=1569858669218&amp;cacheVersion=1&amp;api=v2&amp;width=672&amp;height=363" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddav71106afedf2e50eb7e4bf715019bf3c1.png?version=1&amp;modificationDate=1569858669218&amp;cacheVersion=1&amp;api=v2&amp;width=900&amp;height=487 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896570123/worddav71106afedf2e50eb7e4bf715019bf3c1.png?version=1&amp;modificationDate=1569858669218&amp;cacheVersion=1&amp;api=v2&amp;width=672&amp;height=363 1x" /></span><br />When the Deployment Packager detects that a SQL script has been merged into the source code control branch associated with a specific environment, it will search for Change Sets with a label that matches the script names and compare scriptChecksum values in order to validate that the scripts have not been modified since they were originally Packaged. When matches are found, the <strong>context</strong> for the new database definition is added to those Change Sets. The new context makes them available for Deployment in the new environments.</p>
        <p>Follow the steps below to configure your <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> project to take advantage of Feature Based Merge mode.</p>
        <ol>
            <li>Configure environment specific branch properties in the deployPackager.properties file.&#160;For this merge mode, your property names should take the format of&#160;<em>&lt;dbdefName&gt;.branch.&#160;</em>See <a href="../../documentation/package-sql-scripts-for-deployment/Using_the_Required_deployPackager_properties_File.htm" rel="nofollow">Using the required deployPackager.properties file</a>.</li>
            <li>Add a unique identifying default <strong>context</strong> to each database definition in your project. This default context is required to take advantage of Feature Based Merge mode.</li>
            <li>Configure the 'enableBackupRestore' property in the deployPackager.properties file for your <MadCap:variable name="General.DaticalDB" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> project. The value of this property is a comma separated list of environments that are safe to backup and restore. NOTE: Running the Packager's backup and restore routines is not recommended for environments beyond development and test.</li>
        </ol>
        <p>Run the Deployment Packager and target the dbdef to which you wish to merge and deploy changes. Detection and handling of merged scripts should occur automatically when the Deploy Packager is run in SCM mode.</p>
    </body>
</html>