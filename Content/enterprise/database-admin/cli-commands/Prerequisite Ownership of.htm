<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us">
    <head><title></title>
        <link href="../../../Resources/Stylesheets/Oracle+on+Amazon+RDS+Setup.css" rel="stylesheet" />
    </head>
    <body>
        <h1 class="Heading1">Prerequisite: Ownership of Schema and Database Objects</h1> <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_enterprise.flsnp" />
        <p class="NormalWeb">In order for Datical DB to manage an existing Postgres instance, it must connect as a user with at least one of the following requirements:</p>
        <ul class="ul_2">
            <li class="li_1">
                <p class="p_1">Owns all schema to be managed by Datical DB <span class="Strong">and</span> owns all objects in those schema.</p>
            </li>
            <li class="li_1">
                <p class="p_1">Is a superuser (on-prem onlyâ€“the superuser on Amazon RDS or Aurora does not have sufficient permissions)</p>
            </li>
        </ul>
        <p class="NormalWeb">Postgres has a distinction between ownership and privilege, and only one user may own an object. Only the owner (or a superuser) may alter or drop a given object. Therefore, simply granting the owner's role to another user is not sufficient. Ownership must be explicitly transferred (see below). <span class="span_1">When managing Postgres databases, please disregard any documentation referencing the use of multiple roles for Datical DB connection users.</span></p>
        <p class="NormalWeb">"The right to modify or destroy an object is always the privilege of the owner only." - from PostgreSQL documentation <a href="https://www.postgresql.org/docs/9.6/ddl-priv.html" class="Hyperlink">https://www.postgresql.org/docs/9.6/ddl-priv.html</a></p>
        <p class="NormalWeb">Since it is necessary for Datical DB to perform both backup and restore operations on all schema it manages (which involves dropping and recreating entire schema and their objects), its connection user must own these schema and objects. If it does not, packaging fails and a permissions error is reported.&#160;</p>
        <p class="title">Special Instructions for Postgres in Amazon RDS</p>
        <p class="NormalWeb">If you are using Postgres for Amazon RDS or for Aurora, the admin user they provide is NOT a true superuser and its privileges are NOT sufficient to perform Datical DB operations. The user specified in the DbDef connection must&#160;&#160;have proper permissions on the database (<span class="Emphasis">connect</span>, <span class="Emphasis">create</span>, and <span class="Emphasis">temporary</span> are suggested) as well as ownership of schema and objects as described above. See AWS documentation for more information.</p>
        <p class="NormalWeb">&#160;</p>
        <p>
            <img src="../../../Resources/Images/Postgres+EDB+and+PostgreSQL+Setup/Prerequisite Ownership of.png" class="img_1" /><span class="expand-control-text">Instructions for Reassigning Object Ownership in Postgres for Amazon RDS</span> </p>
        <p class="NormalWeb">The following steps to reassign object ownership without superuser privileges&#160;can be taken in Postgres in Amazon RDS environments</p>
        <p class="NormalWeb">1. Create a new role named 'change_owner' and grant it the LOGIN privilege</p>
        <p class="HTMLPreformatted">mydb=&gt; CREATE ROLE change_owner LOGIN;</p>
        <p class="HTMLPreformatted">CREATE ROLE</p>
        <p class="HTMLPreformatted">
            <br />2. Make both the current owner ('old_owner') and the new Datical owner ('new_ddb_owner') roles members of the newly created role</p>
        <p class="HTMLPreformatted">mydb=&gt; GRANT old_owner TO change_owner; </p>
        <p class="HTMLPreformatted">GRANT ROLE </p>
        <p class="HTMLPreformatted">mydb=&gt; GRANT new_ddb_owner TO change_owner; </p>
        <p class="HTMLPreformatted">GRANT ROLE</p>
        <p class="NormalWeb">&#160;</p>
        <p class="NormalWeb">3. Logout from psql and login using the new role</p>
        <p class="HTMLPreformatted">$ psql -U change_owner mydb</p>
        <p class="HTMLPreformatted">mydb=&gt;</p>
        <p class="NormalWeb">&#160;</p>
        <p class="NormalWeb">4. Execute the reassignment</p>
        <p class="HTMLPreformatted">mydb=&gt; REASSIGN OWNED BY old_owner TO new_ddb_owner </p>
        <p class="HTMLPreformatted">REASSIGN OWNED</p>
        <p class="NormalWeb">
            <br />Courtesy of&#160;<a href="https://sysadmintips.com/services/databases/postgresql-error-permission-denied-to-reassign-objects/" class="Hyperlink">sysadmintips.com</a></p>
        <h2 class="Heading2">Pipeline Steps in the Project</h2>
        <p class="NormalWeb">Each database in your release pipeline is represented as a step in the Datical DB project. <span class="span_1">Each step has its own set of connection information, including the user to connect as (the </span><span class="Strong_1">connection user</span><span class="span_1">).</span></p>
        <p class="NormalWeb">At each step, the connection user must be the owner of all schema managed by Datical DB and the owner of all objects in that schema.</p>
        <p class="title">Note</p>
        <p class="NormalWeb">You do not have to use the same user for every step in the pipeline, as long as that user has the requisite ownership to perform Datical DB operations.</p>
    </body>
</html>