<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <link rel="canonical" href="https://docs.liquibase.com/start/tutorials/mongodb/mongodb-pro.html" />
        <meta name="description" content="This page guides you through the process of creating a new Liquibase project with MongoDB." />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <h1>MongoDB Community and  Enterprise Server</h1>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/images/icon-pro-top.flsnp" />
        <p>MongoDB offers several NoSQL database products. This guide describes how to use the <a href="home.htm"><MadCap:variable name="General.Liquibase" /> MongoDB Pro Extension</a> with <a href="https://www.mongodb.com/try/download/community">MongoDB Community Server</a> and <a href="https://www.mongodb.com/try/download/enterprise">MongoDB Enterprise Server</a>.</p>
        <p>This guide does not imply support for third-party clones or emulations of MongoDB. It also does not describe the community-maintained <MadCap:variable name="General.Liquibase" /> MongoDB extension. For information on that extension, see <a href="https://contribute.liquibase.com/extensions-integrations/directory/database-tutorials/mongodb/">Contribute&#160;Docs:&#160;Use Liquibase with MongoDB</a>.</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The MongoDB Pro Extension requires <MadCap:variable name="General.Liquibase" /> 4.20.0+ and Java 11. It is only available to <MadCap:variable name="General.LBPro" /> users.</p>
        <h2>Verified versions</h2>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/text/database-tutorials/verified-versions/mongodb-pro.flsnp" />
        <p>
            <h2>Verification level</h2>
            <MadCap:snippetBlock src="../../../Z_Resources/Snippets/def/database-verification-levels.flsnp" />
            <MadCap:snippetBlock src="../../../Z_Resources/Snippets/def/database-verification-level-foundational.flsnp" />
        </p>
        <h2>Prerequisites</h2>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/text/database-tutorials/database-prerequisites.flsnp" />
        <h2>Implement the MongoDB Pro extension</h2>
        <ol>
            <li>If you have the current open source MongoDB&#160;version installed, remove it and the associated drivers from your machine.</li>
            <li>Ensure that your <MadCap:xref href="mongodb-pro-user-roles.htm">MongoDB Pro Extension User Roles</MadCap:xref> are established before continuing.</li>
            <li><a href="https://www.mongodb.com/try/download/shell">Download and Install mongosh</a> if it is not already installed on your machine.</li>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"><code>mongosh</code> is mandatory to use MongoDB&#160;with <MadCap:variable name="General.LBPro" /> and it must be accessible to <MadCap:variable name="General.Liquibase" />. We recommend that mongosh is in the system <code>PATH</code>&#160;environment variable. If it is not, that location of mongosh must be manually specified in the <code>liquibase.mongosh.conf</code> file.</p>
            <li><a href="https://www.oracle.com/java/technologies/downloads/#java11">Download Java 11</a>. The MongoDB&#160;Pro Extension requires it.</li>
            <p class="tip" MadCap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">Java 11 may already be present on your machine if you used the installer to install <MadCap:variable name="General.Liquibase" />. We recommend installing <MadCap:variable name="General.Liquibase" /> with Java 11 with the <a href="https://github.com/liquibase/liquibase/releases">installer asset available on GitHub</a>.</p>
            <li><a href="https://mvnrepository.com/artifact/org.liquibase.ext/liquibase-commercial-mongodb">Download the JAR file</a> that contains the MongoDB&#160;Pro Extension and drivers from Maven Central. <MadCap:snippetText src="../../../Z_Resources/Snippets/text/database-tutorials/database-driver.flsnp" MadCap:conditionTagExpression="include[database-driver.driver-manually-installed or database-driver.maven-jar-public]" /><pre xml:space="preserve"><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.liquibase.ext&lt;/groupId&gt;
    &lt;artifactId&gt;liquibase-commercial-mongodb&lt;/artifactId&gt;
    &lt;version&gt;1.1.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre></li>
        </ol>
        <h2>Configure your TLS/SSL encrypted connection</h2>
        <p>If you are using TLS/SSL, configure the TLS/SSL encrypted connection for the MongoDB Pro extension.</p>
        <p class="tip" MadCap:autonum="&lt;b&gt;Tip: &lt;/b&gt;">This is only required if you are using TLS/SSL because it is active on your Mongo server or because  you are using MongoDB Atlas.</p>
        <ol>
            <li>Configure the MongoDB instance by first following <a href="https://www.mongodb.com/docs/manual/tutorial/configure-ssl/">Mongo's configuration guide</a>.</li>
            <li>Then verify that it works by following <a href="https://www.mongodb.com/docs/manual/tutorial/configure-ssl-clients/#connect-to-mongodb-instance-using-encryption--tls-options-">Mongo's verification guide</a>.</li>
            <li>Add the <code>--tlsCertificateKeyFile</code> certificate that is produced in the configuration step above to the Java keystore. The <code>--tlsCertificateKeyFile</code> specifies the <code>.pem</code> file that contains mongosh's certificate.</li>
            <p>On Linux:</p><pre><code class="language-text">sudo keytool -importcert -trustcacerts -file PATH_TO_CERT_FILE/mongodb-cert.crt -cacerts -storepass changeit -alias MongoDB</code></pre>
            <p>On Windows, open terminal in Administrator mode and run:</p><pre><code class="language-text">keytool -importcert -trustcacerts -file PATH_TO_CERT_FILE\\mongodb-cert.crt -cacerts -storepass changeit -alias mongodb</code></pre>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The default password for keystore is <code>changeit</code>.</p>
            <li>
                <p>Add the <code>url</code> parameter to the CLI, <MadCap:variable name="General.liquiPropFile" /> file, or set it as an environment variable:</p>
                <p class="example" MadCap:autonum="&lt;b&gt;Example: &lt;/b&gt;"><MadCap:variable name="General.liquiPropFile" /> file:<br /><code>liquibase.command.url=mongodb+srv://&lt;hostname&gt;/&lt;database&gt;</code><br /><code>liquibase.command.url: mongodb://localhost:27017/lbcat?tls=true&amp;tlsCAFile=mongodb.pem</code><br /><br />Environment variable:<br /><code>LIQUIBASE_COMMAND_URL=mongodb+srv://&lt;hostname&gt;/&lt;database&gt;</code><br /><code>LIQUIBASE_COMMAND_URL: mongodb://localhost:27017/lbcat?tls=true&amp;tlsCAFile=mongodb.pem</code><br /></p>
                <p>If you are using a Java keystore that is not the default, you must add the necessary environment variables before running <MadCap:variable name="General.Liquibase" /> commands.</p>
                <p>On Linux:</p><pre><code class="language-text">export JAVA_OPTS="-Djavax.net.ssl.keyStore=PATH_TO_KEYSTORE/cacerts -Djavax.net.ssl.keyStorePassword=PASSWORD"</code></pre>
                <p>On Windows:</p><pre><code class="language-text">set JAVA_OPTS=-Djavax.net.ssl.keyStore="PATH_TO_KEYSTORE\\cacerts" -Djavax.net.ssl.keyStorePassword=PASSWORD</code></pre>
                <p>Do not use <code>setx</code> as it adds <code>keyStorePassword</code> to system environment variables.</p>
            </li>
        </ol>
        <h3>Troubleshooting errors</h3>
        <p>After connecting <MadCap:variable name="General.Liquibase" /> with the MongoDB&#160;Pro Extension, you may come across an error that states:</p><pre><code class="language-text">Error: Could not find or load main class Files\\Java\\{jdk-version}.security.cacerts Caused by: java.lang.ClassNotFoundException: Files\\Java\\{jdk-version}.security.cacerts</code></pre>
        <p>This means that <MadCap:variable name="General.LBPro" /> is struggling to find the certification file. To resolve the issue, run the following command in the CLI:</p>
        <p>On Windows:</p><pre><code class="language-text">set JAVA_OPTS=-Djavax.net.ssl.keyStore="%JAVA_HOME%\\lib\\security\\cacerts"</code></pre>
        <p>On Linux:</p><pre><code class="language-text">export JAVA_OPTS=-Djavax.net.ssl.keyStore=$JAVA_HOME/lib/security/cacerts</code></pre>
        <h2>Test your connection</h2>
        <ol>
            <li>Ensure your MongoDB database is configured. See <a href="https://www.mongodb.com/docs/manual/installation/">Install MongoDB</a> for more information.</li>
            <li>
                <MadCap:snippetText src="../../../Z_Resources/Snippets/text/database-tutorials/database-properties-url.flsnp" />
            </li><pre xml:space="preserve"><code class="language-html">url: mongodb://hostname:27017/myDatabase</code></pre>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">If you are unsure about how to configure the <code>url</code> property, refer to <a href="https://docs.mongodb.com/manual/reference/connection-string/">Connection String URI Format</a>.</p>
            <MadCap:snippetBlock src="../../../Z_Resources/Snippets/note/database-license-key.flsnp" />
        </ol>
        <MadCap:snippetBlock src="../../../Z_Resources/Snippets/text/database-tutorials/database-changelog-test-connection.flsnp" MadCap:conditionTagExpression="include[database.mongodb]" />
        <h2>Related links</h2>
        <ul>
            <li>
                <MadCap:xref href="mongodb-pro-user-roles.htm">MongoDB Pro Extension User Roles</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="mongodb-pro-amazon-documentdb.htm">MongoDB Pro and Amazon DocumentDB</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="mongodb-pro-aws-doc-config.htm">MongoDB Pro and Amazon DocumentDB TLS/SSL&#160;Configuration</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="mongodb-atlas-config.htm">MongoDB Atlas</MadCap:xref>
            </li>
            <li><a href="https://contribute.liquibase.com/extensions-integrations/directory/tutorials/mongodb/">Contributor Docs:&#160;Open Source MongoDB Extension</a>
            </li>
        </ul>
    </body>
</html>