<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Default.EXCLUDE">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <meta rel="canonical" href="https://docs.liquibase.com/start/tutorials/mongodb-pro-aws-doc-config.html" />
        <meta name="description" content="Follow this guide to establish a connection between the MongoDB&#160;Pro extension and AWS DocumentDB (TLS is enabled)." />
    </head>
    <body>
        <h1> MongoDB Pro and AWS DocumentDB TLS/SSL&#160;Configuration </h1>
        <p>To use <MadCap:variable name="General.Liquibase" /> with AWS&#160;DocumentDB&#160;successfully, you must utilize the MongoDB&#160;Pro extension to create a connection between the two. Follow the instructions below to establish a connection between the MongoDB&#160;Pro extension and AWS DocumentDB (TLS is enabled).</p>
        <ol>
            <li>Follow the AWS instruction <a href="https://docs.aws.amazon.com/documentdb/latest/developerguide/connect-from-outside-a-vpc.html">Connecting to an Amazon DocumentDB Cluster from Outside an Amazon VPC</a> if needed to connect from outside an Amazon VPC.</li>
            <li>Create Java Truststore. Items 1 and 2 in the <code>Connecting with TLS Enabled</code> (for Java snippet)</li>
            <li>Add AWS DocumentDB credentials (<code>liquibase.command.username</code>, <code>liquibase.command.password</code>) to the <code>liqubase.properties</code> file, environment variables, or command line.</li>
            <li>Add the property:<br /> <code>liquibase.mongodb.supportsValidator: false</code></li>
            <li>Add a connection string in format: <br /><code>liquibase.command.url: mongodb://localhost:27017/lbcat?tls=true&amp;tlsAllowInvalidHostnames=true&amp;retryWrites=false&amp;tlsCAFile=PATH_TO_TRUSTSTORE/rds-combined-ca-bundle.pem</code></li>
            <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The <code>location localhost:27017</code> is used from the SSH tunnel (created on the first step) <br /><br />For connection from outside an Amazon VPC, it should contain attributes <code>tls=true&amp;tlsAllowInvalidHostnames=true&amp;retryWrites=false&amp;tlsCAFile=PATH_TO_TRUSTSTORE/rds-combined-ca-bundle.pem</code></p>
            <li>Add information about Truststore (created on the second step) to environment variables before running liquibase commands:</li>
            <ul>
                <p>On Linux:</p>
                <p><code>export JAVA_OPTS="-Djavax.net.ssl.trustStore=PATH_TO_TRUSTSTORE/rds-truststore.jks -Djavax.net.ssl.trustStorePassword=PASSWORD"</code>
                </p>
                <p>On Windows:</p>
                <p><code>set JAVA_OPTS=-Djavax.net.ssl.trustStore="PATH_TO_KEYSTORE\\rds-truststore.jks" -Djavax.net.ssl.trustStorePassword=PASSWORD</code>
                </p>
            </ul>
        </ol>
    </body>
</html>