<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Default.EXCLUDE">
    <head>
        <MadCap:changeData>
            <MadCap:RemoveChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="1" MadCap:timestamp="2023-04-03T15:46:25.3953975-04:00" />
            <MadCap:AddChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="2" MadCap:timestamp="2023-04-03T15:46:25.4242431-04:00" />
            <MadCap:AddChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="3" MadCap:timestamp="2023-04-03T15:48:07.1234084-04:00" />
            <MadCap:AddChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="4" MadCap:timestamp="2023-04-03T15:51:58.3261766-04:00" />
            <MadCap:BindChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="5" MadCap:timestamp="2023-04-03T15:54:44.5740403-04:00" />
            <MadCap:RemoveChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="6" MadCap:timestamp="2023-04-03T15:55:02.8070699-04:00" />
            <MadCap:AddChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="7" MadCap:timestamp="2023-04-03T15:55:02.8090668-04:00" />
            <MadCap:AttributesChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="8" MadCap:timestamp="2023-04-03T15:57:05.0586129-04:00" MadCap:attribute="style" />
            <MadCap:AddChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="9" MadCap:timestamp="2023-04-03T15:57:27.3967243-04:00" />
            <MadCap:RemoveChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="10" MadCap:timestamp="2023-04-03T15:57:32.4553557-04:00" />
            <MadCap:AddChange MadCap:userName="CatherineMayFulton" MadCap:initials="CA" MadCap:id="11" MadCap:timestamp="2023-04-03T15:58:31.1705071-04:00" />
        </MadCap:changeData><title><MadCap:variable name="Heading.Level1" /></title>
        <meta rel="canonical" href="https://docs.liquibase.com/start/tutorials/mongodb-pro.html" />
        <meta name="description" content="The MongoDB&#160;Pro Extension streamlines the workflow for MongoDB users. It allows you to use MongoDB's native language in changesets and change types. All of this is possible because MongoDB Shell (mongosh) is compatible with Liquibase Pro." />
    </head>
    <body>
        <h1>MongoDB Pro Extension</h1>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">MongoDB is available in <MadCap:variable name="General.LBPro" /> version 4.20.1</p>
        <p>The MongoDB&#160;Pro Extension streamlines the workflow for MongoDB users. It allows you to use MongoDB's native language in changesets and <MadCap:variable name="General.changetypes" />s. All of this is possible because  MongoDB&#160;Shell (mongosh) is compatible with <MadCap:variable name="General.LBPro" />.  MongoDB also supports  Targeted Rollback, <MadCap:annotation MadCap:createDate="2023-04-03T15:45:29.4822407-04:00" MadCap:creator="CatherineMayFulton" MadCap:initials="CA" MadCap:comment="link" MadCap:editor="CatherineMayFulton" MadCap:editDate="2023-04-03T15:45:31.1848103-04:00">Flows</MadCap:annotation>, and <MadCap:annotation MadCap:createDate="2023-04-03T15:45:43.4527703-04:00" MadCap:creator="CatherineMayFulton" MadCap:initials="CA" MadCap:comment="link" MadCap:editor="CatherineMayFulton" MadCap:editDate="2023-04-03T15:45:44.8965750-04:00"><MadCap:variable name="General.changelog" />-level quality checks</MadCap:annotation> with <MadCap:variable name="General.LBPro" />. Learn the details and how to implement this functionality below.</p>
        <h2>MongoDB Pro extension functionality</h2>
        <p>Some inherent <MadCap:variable name="General.Liquibase" /> functionality is different in the MongoDB Pro Extension because of the nature of Mongo. This does not limit the use of MongoDB<MadCap:change MadCap:changes="2">;</MadCap:change><MadCap:change MadCap:changes="1">,</MadCap:change> it simply means that you must be aware of these nuances to successfully use this extension. The points below are essential to using the Pro extension successfully.<br /></p>
        <ul>
            <li>As of <MadCap:variable name="General.LBPro" /> version 4.20.1, JSON&#160;and YAML&#160;<MadCap:variable name="General.changelog" />s are supported<MadCap:change MadCap:changes="2">,</MadCap:change> along with the legacy support of XML <MadCap:variable name="General.changelog" />s.</li>
            <li>MongoDB is a noSQL database, which means you are unable to use any commands that generate <code>sql</code> output. Learn more about <MadCap:xref href="../../commands/home.htm">[%=General.<MadCap:variable name="General.Liquibase" />%] Commands</MadCap:xref> here.<ul><li>Rollback commands are supported<MadCap:change MadCap:changes="3">,</MadCap:change> with the exception of any rollback commands that generate <code>sql</code> output.</li><li>Change tracking commands are supported<MadCap:change MadCap:changes="3">,</MadCap:change> with the exception of any commands that generate <code>sql</code> output.</li></ul></li>
            <li>The only Quality Checks that work with the MongoDB&#160;Pro Extension are Changelog-level Quality Checks. Learn more about <MadCap:xref href="../../commands/quality-checks/home.htm">Quality Checks</MadCap:xref> here.</li>
            <li>These quality checks work only if you have created your own <MadCap:change MadCap:changes="4">noun? </MadCap:change>from the regex template. <MadCap:variable name="General.Liquibase" /> uses the <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/util/regex/Pattern.html">java.util.regex</a> engine to match regular expressions. </li>
            <li><code>mongo </code>and <code>mongoFile </code>are the two <MadCap:variable name="General.changetypes" />s allowed. They must use the Native Executor, Mongo Shell (mongosh).</li>
        </ul>
        <h2>Implement the MongoDB Pro extension</h2>
        <ol>
            <li>If you have the current open source MongoDB&#160;version installed, remove it and the associated drivers from your machine.</li>
            <li>Ensure that your <MadCap:xref href="mongodb-pro-user-roles.htm">MongoDB&#160;Pro Extension User Roles</MadCap:xref> are established before continuing.</li>
            <li><a href="https://www.mongodb.com/try/download/shell">Download and Install mongosh</a> if it is not already installed on your machine. <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">Mongosh is mandatory to use MongoDB&#160;with <MadCap:variable name="General.LBPro" />. This allows you to interact with MongoDB in NodeJS REPL and run all possible queries conveniently.</p></li>
            <li>Follow the Prerequisite steps:<br /></li>
            <p>
                <MadCap:snippetBlock src="../../Z_Resources/Snippets/text/database-prerequisites.flsnp" />
            </p>
            <li>Download the ZIP file that contains the MongoDB&#160;Pro Extension and drivers from <span MadCap:changes="5" style="background-color: #ffff00;">(insert link once available).</span><br /><p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">If you are a Maven user, do not download the MongoDB Pro Extension zip file. You only need to specify the dependency listed below in your pom.xml file and <MadCap:change MadCap:changes="7">Maven will download </MadCap:change>all required artifacts <MadCap:change MadCap:changes="6">will download by Maven</MadCap:change>.<br /></p><MadCap:codeSnippet><MadCap:codeSnippetCopyButton /><MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: XML;">&lt;dependency&gt;
    &lt;groupId&gt;org.liquibase.ext&lt;/groupId&gt;
    &lt;artifactId&gt;liquibase-commercial-mongodb&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;</MadCap:codeSnippetBody></MadCap:codeSnippet><br /></li>
            <li>Extract the single Uber JAR&#160;file and install the extension.</li>
            <li>Implement your <MadCap:variable name="General.LBPro" /> key. Learn <MadCap:xref href="../../workflows/liquibase-pro/how-to-apply-your-liquibase-pro-license-key.htm">How to Apply Your [%=General.LBPro%] License Key here.</MadCap:xref></li>
            <li>Configure the TLS/SSL&#160;encrypted connection for the MongoDB&#160;Pro extension.<ol MadCap:changes="8" style="list-style-type: lower-alpha;"><li>Configure the MongoDB&#160;instance by first following<MadCap:change MadCap:changes="9">the</MadCap:change> <a href="https://www.mongodb.com/docs/manual/tutorial/configure-ssl/">Mongo<MadCap:change MadCap:changes="10">'s</MadCap:change> configuration guide<MadCap:change MadCap:changes="10"> here</MadCap:change></a>.</li><li><MadCap:change MadCap:changes="10">Then </MadCap:change><MadCap:change MadCap:changes="9">V</MadCap:change><MadCap:change MadCap:changes="10">v</MadCap:change>erify that <MadCap:change MadCap:changes="9">your instance </MadCap:change><MadCap:change MadCap:changes="10">it </MadCap:change>works by following <MadCap:change MadCap:changes="9">the</MadCap:change><a href="https://www.mongodb.com/docs/manual/tutorial/configure-ssl-clients/#connect-to-mongodb-instance-using-encryption--tls-options-">Mongo<MadCap:change MadCap:changes="10">'s</MadCap:change> verification guide<MadCap:change MadCap:changes="10"> here</MadCap:change></a>.</li><li>Add the <code>--tlsCertificateKeyFile</code> certificate that is produced in the configuration step above to the Java keystore:<ul><li>On Linux:<pre>sudo keytool -importcert -trustcacerts -file PATH_TO_CERT_FILE/mongodb-cert.crt -cacerts -storepass changeit -alias MongoDB</pre></li><li>On Windows: Open terminal in Administrator mode and run<pre>keytool -importcert -trustcacerts -file PATH_TO_CERT_FILE\\mongodb-cert.crt -cacerts -storepass changeit -alias mongodb</pre></li></ul><p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"><b>changeit</b> is the default password for keystore.</p></li><li><p>Add the URL parameter to the CLI, <MadCap:variable name="General.liquiPropFile" /> file, or<MadCap:change MadCap:changes="11"> </MadCap:change>set it as an environment variable:<br /></p><p class="example" MadCap:autonum="&lt;b&gt;Example: &lt;/b&gt;"><br /><MadCap:variable name="General.liquiPropFile" /> file:<br /><code>liquibase.command.url: mongodb://localhost:27017/lbcat?tls=true&amp;tlsCAFile=mongodb.pem</code><br /><br />environment variable:<br /><code>LIQUIBASE_COMMAND_URL: mongodb://localhost:27017/lbcat?tls=true&amp;tlsCAFile=mongodb.pem</code><br /></p></li><li><p>If you are using a Java keystore that is not the default, you must add the necessary environment variables before running <MadCap:variable name="General.Liquibase" /> commands.</p><ul><li>On Linux:<pre>export JAVA_OPTS="-Djavax.net.ssl.keyStore=PATH_TO_KEYSTORE/cacerts -Djavax.net.ssl.keyStorePassword=PASSWORD"</pre></li><li>On Windows:<pre>set JAVA_OPTS=-Djavax.net.ssl.keyStore="PATH_TO_KEYSTORE\\cacerts" -Djavax.net.ssl.keyStorePassword=PASSWORD</pre>Do not use <code>setx</code> as it adds keyStorePassword to system environment variables</li></ul></li></ol></li>
        </ol>
        <h3>Troubleshoot Windows error</h3>
        <p>After connecting <MadCap:variable name="General.Liquibase" /> with the MongoDB&#160;Pro Extension on a Windows machine, you may come across an error that states:</p><pre>Error: Could not find or load main class Files\\Java\\{jdk-version}.security.cacerts Caused by: java.lang.ClassNotFoundException: Files\\Java\\{jdk-version}.security.cacerts</pre>
        <p>This means that <MadCap:variable name="General.LBPro" /> is struggling to find the certification file. To resolve the issue, run the following command in the CLI:</p>
        <ul>
            <li>
                <p>On Windows:</p><pre>set JAVA_OPTS=-Djavax.net.ssl.keyStore="%JAVA_HOME%\\lib\\security\\cacerts"</pre>
            </li>
        </ul>
        <h2>Test your connection</h2>
        <MadCap:snippetBlock src="../../Z_Resources/Snippets/text/test-your-connection-mongodb.flsnp" />
    </body>
</html>