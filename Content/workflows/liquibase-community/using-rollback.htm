<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
		<title>Rolling back Changesets | Liquibase Docs</title>
        <link href="../../Z_Resources/Stylesheets/TableStyles.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h1>Rolling back <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i></h1>
        <p><MadCap:variable name="General.Liquibase" /> allows you to undo changes you have made to your database, either automatically or via custom rollback SQL. Rollback support is available in command line, Ant, and Maven.</p>
        <h2>How Rollback SQL is controlled</h2>
        <p>Many <MadCap:variable name="General.changetypes" />s such as <code>create table</code>, <code>rename column</code>, and <code>add column</code> can automatically create rollback statements. If your <MadCap:variable name="General.changelog" style="font-style: italic;" /> contains only statements that fit into this category, your rollback commands will be generated automatically.</p>
        <p>Other <MadCap:variable name="General.changetypes" />s such as <code>drop table</code> and <code>insert data</code> have no corresponding rollback commands that can be automatically generated. In these cases, and cases where you want to override the default generated rollback commands, you can specify the rollback commands via the tag within the <MadCap:variable name="General.changeset" style="font-style: italic;" /> tag. If you do not want anything done to undo a change in rollback mode, use an empty tag.</p>
        <h2>Rollback Tag Available Attributes</h2>
        <table style="width: 100%;mc-table-style: url('../../Z_Resources/Stylesheets/TableStyles.css');" class="TableStyle-TableStyles" cellspacing="0">
            <col class="TableStyle-TableStyles-Column-Column1" />
            <col class="TableStyle-TableStyles-Column-Column1" />
            <thead>
                <tr class="TableStyle-TableStyles-Head-Header1">
                    <th class="TableStyle-TableStyles-HeadE-Column1-Header1">Attribute</th>
                    <th class="TableStyle-TableStyles-HeadD-Column1-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-TableStyles-Body-Body1">
                    <td class="TableStyle-TableStyles-BodyE-Column1-Body1">nested tags</td>
                    <td class="TableStyle-TableStyles-BodyD-Column1-Body1">Standard <MadCap:variable name="General.Liquibase" /> change tags to generate rollback statements </td>
                </tr>
                <tr class="TableStyle-TableStyles-Body-Body2">
                    <td class="TableStyle-TableStyles-BodyE-Column1-Body2">tag text</td>
                    <td class="TableStyle-TableStyles-BodyD-Column1-Body2">SQL to run to rollback this change. The text in the element is treated as a sql change with <code>stripComments</code> set to <code>true</code>, <code>splitStatements </code>set to <code>true</code> and <code>endDelimiter </code>set to <code>;</code>.</td>
                </tr>
                <tr class="TableStyle-TableStyles-Body-Body1">
                    <td class="TableStyle-TableStyles-BodyE-Column1-Body1"><code>changeSetId</code>
                    </td>
                    <td class="TableStyle-TableStyles-BodyD-Column1-Body1">	ID of <MadCap:variable name="General.changeset" style="font-style: italic;" /> you need to run again to rollback this change. Example: for rolling back a <code>dropTable</code> change, reference the <MadCap:variable name="General.changeset" style="font-style: italic;" /> that created the table. </td>
                </tr>
                <tr class="TableStyle-TableStyles-Body-Body2">
                    <td class="TableStyle-TableStyles-BodyB-Column1-Body2"><code>changeSetAuthor</code>
                    </td>
                    <td class="TableStyle-TableStyles-BodyA-Column1-Body2">Author of <MadCap:variable name="General.changeset" style="font-style: italic;" /> to rerun in order to rollback this change </td>
                </tr>
            </tbody>
        </table>
        <h2>Samples</h2>
        <p>Many change tags do not need a rollback tag. They can be generated from the update statement.</p><pre><code class="language-html">&lt;changeSet id="changeRollback2-create" author="nvoxland"&gt;
	&lt;createTable tableName="changeRollback2"&gt;
		&lt;column name="id" type="int"/&gt;
	&lt;/createTable&gt;
&lt;/changeSet&gt;</code></pre>
        <p>Standard change tags can be used in a &lt;rollback&gt; tag</p><pre><code class="language-html">&lt;changeSet id="changeRollback" author="nvoxland"&gt;
	&lt;createTable tableName="changeRollback1"&gt;
		&lt;column name="id" type="int"/&gt;
	&lt;/createTable&gt;
	&lt;rollback&gt;
		&lt;dropTable tableName="changeRollback1"/&gt;
	&lt;/rollback&gt;
&lt;/changeSet&gt;</code></pre>
        <p style="font-style: italic;">Multiple statements can be included in one &lt;rollback&gt; tag. Multiple rollback tags can be specified in one <MadCap:variable name="General.changeset" />.</p><pre><code class="language-html">&lt;changeSet id="multiRollbackTest" author="rs"&gt;
	&lt;createTable tableName="multiRollback1"&gt;
		&lt;column name="id" type="int"/&gt;
	&lt;/createTable&gt;
	&lt;createTable tableName="multiRollback2"&gt;
		&lt;column name="id" type="int"/&gt;
	&lt;/createTable&gt;
	&lt;createTable tableName="multiRollback3"&gt;
		&lt;column name="id" type="int"/&gt;
	&lt;/createTable&gt;
	&lt;rollback&gt;
		drop table multiRollback1;
		drop table multiRollback2;
	&lt;/rollback&gt;
	&lt;rollback&gt;drop table multiRollback3&lt;/rollback&gt;
&lt;/changeSet&gt;</code></pre>
        <p>A rollback tag can reference the <MadCap:variable name="General.changeset" style="font-style: italic;" /> that originally created a statement.</p><pre><code class="language-html">&lt;changeSet id="changeRollback2-drop" author="nvoxland"&gt;
	&lt;dropTable tableName="changeRollback2"/&gt;
	&lt;rollback changeSetId="changeRollback2-create" changeSetAuthor="nvoxland"/&gt;
&lt;/changeSet&gt;</code></pre>
        <p>Rollback tags can be empty if no rollback is possible/needed</p><pre><code class="language-html">&lt;changeSet id="noRollback" author="nvoxland"&gt;
	&lt;sql&gt;insert into multiRollback3 (id) values (1)&lt;/sql&gt;
	&lt;rollback/&gt;
&lt;/changeSet&gt;</code></pre>
        <h2>“Roll Back To” Modes</h2>
        <p>You can specify what changes to rollback in three ways:</p>
        <h3>Tag</h3>
        <p>Specifying a tag to rollback to will roll back all change-sets that were executed against the target database after the given tag was applied. See the command line documentation for how to tag your database.</p>
        <h3>Number of Change Sets</h3>
        <p>You can specify the number of change-sets to rollback.</p>
        <h3>Date</h3>
        <p>You can specify the date to roll back to.</p>
        <h2>Roll back Execution Modes</h2>
        <p><MadCap:variable name="General.Liquibase" /> has three modes for managing rollbacks:</p>
        <h3>Execute Rollback Directly</h3>
        <p>The rollback commands can be executed directly against the target database. If any changes cannot be rolled back, you will be notified and none of the changes will roll back.</p>
        <h3>Generating a Rollback Script</h3>
        <p>Rather than actually updating the database, the SQL required to roll back the database can be generated. This is useful if you want to preview what rollback commands will be executed before they are actually run.</p>
        <h3>Generating a “Future Rollback” Script</h3>
        <p>This mode is designed to allow you to generate a rollback script at the same time you generate your migration script. It allows you to take an updated application and generate both the SQL to update the database to the new version as well as the SQL to bring that new version back to the current version if needed. This functionality is very useful when a DBA wants to control SQL going into the database, as well as for applications that require rollback documentation for internal and/or “SOX-compliant” processes. You do not need to specify a rollback date, tag, or count in this mode.</p>
    </body>
</html>