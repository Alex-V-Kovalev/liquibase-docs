<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1 id="adding-liquibase-on-an-existing-project">Adding <MadCap:variable name="General.Liquibase" /> on an existing project</h1>
        <p>The <a href="https://www.liquibase.org/get-started">Getting Started Guide</a> works well for starting <MadCap:variable name="General.Liquibase" /> on a new project because your empty <MadCap:variable name="General.changelog" style="font-style: italic;" /> file matches your empty database. 
However, when you have an existing project with an existing database things are more complicated.</p>
        <p>Unfortunately, there is no simple “this is how you do it” answer because there is so much variations in projects, processes and requirements. 
<MadCap:variable name="General.Liquibase" /> provides many tools to help the process, but it is up to you to decide the best way to combine them for your particular situation.</p>
        <p>When adding <MadCap:variable name="General.Liquibase" /> to an existing project there are basically two approaches: “Make it look like you’ve always been using <MadCap:variable name="General.Liquibase" />” and “Just start using <MadCap:variable name="General.Liquibase" />”</p>
        <h2 id="make-it-look-like-youve-always-been-using-liquibase">Make it look like you’ve always been using <MadCap:variable name="General.Liquibase" /></h2>
        <p>The goal of this approach is to have a <MadCap:variable name="General.changelog" style="font-style: italic;" /> file that matches the current state of your database. You can run this <MadCap:variable name="General.changelog" style="font-style: italic;" /> against a blank database and the final result will be indistinguishable from your existing databases–as if you used <MadCap:variable name="General.Liquibase" /> from the beginning.
This approach is usually the best long term, but it can be more work up front.</p>
        <h3>Create <MadCap:variable name="General.changelog" style="font-style: italic;" /></h3>
        <p>Creating the <MadCap:variable name="General.changelog" style="font-style: italic;" /> to match your database can be done automatically using the <MadCap:xref href="../../commands/community/generateChangeLog.html">generateChangeLog command</MadCap:xref> or be done manually. 
For any database larger than a few tables, the <code>generateChangeLog</code> command is usually a good idea but make sure you go through the generated <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> to ensure they are correct. <MadCap:variable name="General.Liquibase" /> does not always detect more complex structures like stored procedures or details like if an index is not clustered. Also, ensure data types are as you expected them.</p>
        <h3>Populate the <MadCap:variable name="General.databasechangelog" /> table</h3>
        <p>Once you have your <MadCap:variable name="General.changelog" style="font-style: italic;" />, you need a way to ensure that the pre-<MadCap:variable name="General.Liquibase" /> <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> are only ran on new, empty databases. The easiest way to do this is generally to use the <code class="highlighter-rouge">changeLogSync</code> or <code class="highlighter-rouge">changeLogSyncSQL</code> command to execute (or generate) the SQL that marks the starting <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> as already ran without actually executing them.</p>
        <p>As an alternative to the <code>changeLogSync</code> command, you can add <MadCap:xref href="../../concepts/advanced/contexts.html">Contexts</MadCap:xref> on the pre-<MadCap:variable name="General.Liquibase" /> <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> such as <code class="highlighter-rouge">&lt;changeSet ... context="legacy"&gt;</code> and when you run <MadCap:variable name="General.Liquibase" /> on a new database you run with <code class="highlighter-rouge">liquibase --contexts=legacy update</code> and on an existing database you run with <code class="highlighter-rouge">liquibase --contexts=non-legacy</code>.</p>
        <p>Finally, you can add <code class="highlighter-rouge">&lt;precondition onFail="MARK_RAN"&gt;</code> tags to the generated <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i>. For example, if you have a <code class="highlighter-rouge">&lt;createTable tableName="person"&gt;</code> <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> , you would add <code class="highlighter-rouge">&lt;preconditions onFail="MARK_RAN"&gt;&lt;not&gt;&lt;tableExists tableName="person"/&gt;&lt;/not&gt;&lt;/preconditions&gt;</code> tag.
Adding preconditions requires more changes to the <MadCap:variable name="General.changelog" style="font-style: italic;" /> file and introduces a performance penalty because <MadCap:variable name="General.Liquibase" /> must check the database metadata for each <MadCap:variable name="General.changeset" style="font-style: italic;" /> the first run through, this approach is usually best used in isolated cases only.</p>
        <h3>What is the current state?</h3>
        <p>Often times a part of the reason to move to <MadCap:variable name="General.Liquibase" /> is because your schemas have diverged over time, so an important question to answer is “If I’m making the <MadCap:variable name="General.changelog" style="font-style: italic;" /> file match the current state, what <strong>is</strong> the current state?”
Usually the best answer to that question is “the production database” but it can vary.</p>
        <p>How divergent your schemas are will also affect which of the above techniques you use to populate the <MadCap:variable name="General.databasechangelog" /> table, and it will often times make sense to use multiple approaches. 
For example, you may want to generate your base <MadCap:variable name="General.changelog" style="font-style: italic;" /><i>s</i> from the production database and use <code>changeLogSyncSQL</code> to be able to mark them ran on everything from production down. 
Then you can add your non-released <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> to the <MadCap:variable name="General.changelog" style="font-style: italic;" /> file with a precondition checking if it has already ran. That will allow <MadCap:variable name="General.Liquibase" /> to automatically figure out the correct state for all your databases from development through production.</p>
        <h2 id="we-are-going-to-use-liquibase-startingnow">We are going to use <MadCap:variable name="General.Liquibase" /> starting…..NOW!</h2>
        <p>Instead of building up a <MadCap:variable name="General.changelog" style="font-style: italic;" /> to match your existing database, you can instead just declare “from now on we are using <MadCap:variable name="General.Liquibase" />”.
The advantage to this is that it much easier to set up because it is just a mandate. 
Usually this works best going from one version to the next because your databases are all in a reasonably consistent state and you simply start tracking database changes in your next version using <MadCap:variable name="General.Liquibase" />. 
Because <MadCap:variable name="General.Liquibase" /> only looks at the <MadCap:variable name="General.databasechangelog" /> table to determine what needs to run, it doesn’t care what else might be in your database and so it will leave all your existing tables alone and just run the new <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i>.</p>
        <p>The biggest disadvantage to this approach is that you cannot bootstrap an empty database with <MadCap:variable name="General.Liquibase" /> alone. A work-around is to take a pre-<MadCap:variable name="General.Liquibase" /> snapshot using your database backup tool and use that as your database seed. 
Any time you need to create a new database, you first load in the seed and then run <MadCap:variable name="General.Liquibase" /> update.</p>
        <p>Depending on how much variation you have between your schemas, even with this approach you may need to rely on preconditions or a “mark changes ran” script in order to standardize and handle those variations.</p>
        <h2 id="people-and-processes">People and processes</h2>
        <p>Finally, remember that starting to use <MadCap:variable name="General.Liquibase" />–especially on an existing project–isn’t just about how you bootstrap your <MadCap:variable name="General.changelog" style="font-style: italic;" /> file. It is also a question of how you introduce <MadCap:variable name="General.Liquibase" /> into your existing processes and culture.</p>
        <p>For many companies and projects, everyone realizes the problems that need fixing and are on board with the advantages of change. 
For others, however, there can be entrenched interests and strong resistance similar to any other process change. 
<MadCap:variable name="General.Liquibase" /> provides many tools and approaches that can be used to ease it into an existing process such as <MadCap:xref href="../../concepts/basic/sql-format.html">[%=General.changelog%]s in SQL Format</MadCap:xref> while using the <MadCap:xref href="../../commands/community/diffChangeLog.html">diffChangeLog command</MadCap:xref> and more that can be combined
in ways that works best for your group.</p>
        <p>If you know that introducing <MadCap:variable name="General.Liquibase" /> is going to be complex, either from a technical or processes standpoint, it is usually best to introduce it slowly.
Start with it on a new project as a trial run and once you have a good grasp of how it works and available options, apply it to other existing projects.</p>
        <p>If you want help getting a project set up, check out <a href="https://liquibase.com/"><MadCap:variable name="General.LBPro" /></a>, which includes support.</p>
    </body>
</html>