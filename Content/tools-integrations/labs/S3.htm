<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Default.EXCLUDE">
    <head>
    </head>
    <body>
        <h1>S3 <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_pro.flsnp" /> <MadCap:snippetText src="../../Resources/Snippets/images/Labs Icon.flsnp" /></h1>
        <p><MadCap:variable name="General.Liquibase" /> integrates the use of Amazon S3 to store and retrieve data from anywhere. Extending <MadCap:variable name="General.Liquibase" /> to use remote file locations enables secure, centralized file management. <MadCap:variable name="General.Liquibase" /> files include changelogs, snapshots, SQL files, liquibase.properties files, native executor configuration files, checks settings configuration files, and flow files. Remote file location access allows you to build a reusable repository of <MadCap:variable name="General.Liquibase" /> files. It also removes the need for all developers to have local copies of Liquibase files, which ensures files are always accurate.</p>
        <h2>Setup S3 with <MadCap:variable name="General.CompanyName" /></h2>
        <p>1. Before using S3 in conjunction with Liquibase, you must configure your AWS&#160;keys via environment variables, configuration files, <MadCap:variable name="General.liquiPropFile" /> file, or Defaults file. That includes the following:<br /></p>
        <p>AWS_SECRET_ACCESS_KEY</p>
        <p>AWS_ACCESS_KEY_ID</p>
        <p>AWS_SESSION_TOKEN</p>
        <p>AWS_REGION</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The AWS_REGION&#160;must be set to the region of your bucket by environment variable, on the CLI, or in the AWS configure file. You should also set a default AWS Region to access AWS with your application. For the best network performance, select a Region that is geographically near to you or your customers.</p>
        <p>2. After  the AWS keys are set up, set up your Pro license key as an environment variable that contains the key, or export the key.
        </p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"><b>Pro license keys</b> can not be stored in the <MadCap:variable name="General.liquiPropFile" />file if the properties file is stored in S3. This is because you have to have the Pro license key to access the S3 files, so you would not be able to access the S3 files if your key was inaccessible. It is best practice to set up an environment variable that contains the key, or export the key.</p>
        <p>Set the <a href="../../concepts/connections/liquibase-environment-variables.htm">environment variable</a> like so:</p>
        <p><code>LIQUIBASE_PRO_LICENSE_KEY=Enter Key Here</code>
            <br />
        </p>
        <p>Export the key like so in the CLI:</p>
        <p><code>export LIQUIBASE_LICENSE+_KEY="Enter Key Here"</code>
        </p>
        <p>3. Run <code>liquibase --changelog-file=sample.changelog.xml update-sql</code> to ensure that the S3 connection is working as expected.</p>
        <p>&#160;</p>
        <h2>File Path Rules:</h2>
        <p>Below are all of the rules that apply to Liquibase using S3. Review the example use cases and instructions to ensure it is the right avenue for your project.</p>
        <h3>1. Full Path</h3>
        <p>You must specify the full path of any file other than a changelog file, snapshot files, or native executor configuration files located in your S3 bucket for <MadCap:variable name="General.Liquibase" /> to find it successfully.  </p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">Paths for changelog files, snapshot files, or native executor configuration files must be split over <a href="searchpath.htm">searchpath</a>.</p>
        <h4>Full Path Example:</h4>
        <p><code>globalVariables:<br></br>DEFAULTSFILE:&#160;"s3://mys3bucket/<MadCap:variable name="General.liquiPropFile"></MadCap:variable></code>
        </p>
        <h3>2. S3 Files Reference Other S3 Files</h3>
        <p> One S3 file can reference another distinct S3. In this example, a Flow file located in a S3 bucket is referenced by a separate s3 bucket. </p>
        <p>See the example below:</p>
        <p><code>flow --flowfile=s3://myS3bucket/liquibase.s3.flowfile.yaml</code>
        </p>
        <h3>Call Bash scripts from a Flow File (ignore for now?)</h3>
        <p>&#160;</p>
        <h3>3. Use multiple S3 locations in the same command</h3>
        <p>Resources are often stored in different S3 locations and Liquibase allows you to find those separate locations in one command. </p>
        <p>For example, Let's say the <code>checks-settings.conf</code> you need is in the DBA’s resources bucket and the <code>flowfile.yaml</code> is in the DevOps Orchestration Team’s bucket. Simultaneously, the <code>changelog</code> is stored locally while you are in dev, but then is relocated to the deploy sub-directory of the DevOps team. You should put the direct full path on the <MadCap:variable name="General.liquiPropFile" /> file as shown below. </p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">The file exceptions to this rule are changelog files, snapshot files, or native executor configuration files which must be split over <a href="searchpath.htm">searchpath</a>.</p>
        <p>
        Example of multiple S3 locations called on in the same command:<br /><br /><code>liquibase --searchpath=s3://devopsteam/deploy --changelogfile=mychangelog.sql flow --flowfile=s3://devopsteam/orchestration/liquibase.production.flowfile.yaml </code><br /></p>
        <h3>4. Use S3 Files Locally</h3>
        <p>Files must be in the same directory structure as they are on S3 to use them locally.  (In what scenario do users need to work locally?)</p>
        <h4>&#160;</h4>
        <h4>Related Content:</h4>
        <ul>
            <li><a href="../../enterprise/developer-get-started-guide/overview-packaging-developer.htm#https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html">AWS Bucket naming rules</a>
            </li>
        </ul>
    </body>
</html>