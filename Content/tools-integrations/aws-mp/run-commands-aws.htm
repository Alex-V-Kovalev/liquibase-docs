<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <link rel="canonical" href="https://docs.liquibase.com/tools-integrations/aws-mp/run-commands-aws.html" />
        <meta name="description" content="This page teaches you how to run Liquibase commands on AWS Marketplace." />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <h1>Run <MadCap:variable name="General.Liquibase"></MadCap:variable> commands on AWS using AWS&#160;Fargate</h1>
        <p>In AWS Task definitions are the equivalent of <MadCap:variable name="General.Liquibase" /> commands. This guide covers how to run <MadCap:variable name="General.Liquibase" /> commands from the Task definitions tooling against the purchased <MadCap:variable name="General.Liquibase" /> license with  AWS&#160;Fargate. <br /><br />Here is a list of AWS&#160;tools that are compatible with <MadCap:variable name="General.Liquibase" /> on AWS in addition to Fargate: Amazon Elastic Container Service (ECS) and Amazon Elastic Kubernetes Service (EKS). </p>
        <h2>Prerequistes</h2>
        <ul>
            <li>It is important to know the <MadCap:variable name="General.changelog" />, <MadCap:variable name="General.liquiPropFile" /> file, JDBC&#160;drivers, and any file you need for <MadCap:variable name="General.Liquibase" /> are located in the S3 bucket associated with your AWS&#160;project.</li>
            <li>Create at least one task definition. Learn to create a task definition from this guide: <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/create-task-definition.html">Creating an Amazon ECS task definition using the console</a></li>
        </ul>
        <h2>Step-by-step</h2>
        <h3>Mount configuration files in Fargate</h3>
        <p>The S3 bucket holds the <MadCap:variable name="General.changelog" />, <MadCap:variable name="General.liquiPropFile" /> file, JDBC&#160;drivers, and any file you need for <MadCap:variable name="General.Liquibase" />. AWS&#160;Fargate needs access to those files, but it does not inherently have access to them. To give AWS&#160;Fargate access to the S3 bucket that holds all of these items, you will mount the configuration file to the Docker container. You do this by using a sidecar container that writes the configuration to an ephemeral volume that is shared by both the Docker container and the volume container. Follow these instructions below to mount the configuration file to the Docker container.</p>
        <ol>
            <li>Navigate to your Amazon Elastic Container Service console. <br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/a-ecs.png" class="thumbnail" /></li>
            <li>Select Task definitions from the left side navigation.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-def.png" class="thumbnail" /></li>
            <li>Select the task definition of your choice.</li>
            <li>Within the specific task definition, check the box next to the revision you want to define the transient volume to<a href="../../Z_Resources/Images/Assets/Screenshots/aws-mp/revision-checkbox.png">.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/revision-checkbox.png" class="thumbnail" /></a></li>
            <li>Expand the <b>Create new task definition</b> menu at the top right of the screen and select <b>Create a new task definition</b>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/new-task-revision.png" class="thumbnail" /></li>
            <li>Ensure that the <b>Launch type</b> selected is <b>AWS&#160;Fargate</b>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/fargate-launch-type.png" class="thumbnail" /></li>
            <li>Select the two ECS task roles.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-role.png" class="thumbnail" /></li>
            <li><b>Container 1</b> is the container in which <MadCap:variable name="General.Liquibase" /> is stored. This is the container you may want to extend the Docker container to use SQL, mySQL, NoSQL, or any other type of extension.<br />Ensure that <b>Container 1</b> has this Image URI: <code>709825985650.dkr.ecr.us-east-1.amazonaws.com/liquibase/liquibase/liquibase-pro:<br /></code></li>
            <li>Ensure that <b>Yes</b> is selected in the <b>Essential container</b> drop-down menu.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/container-1.png" class="thumbnail" /></li>
            <li>Ensure that the Keys are <code>AWS_REGION</code>&#160;witha value of <code>us-east-1</code> and <code>INSTALL_MYSQL</code> with a value of <code>true</code>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/keys.png" class="thumbnail" /><p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"><code>INSTALL_MYSQL</code>&#160;is our <a href="https://github.com/liquibase/docker/blob/main/docker-entrypoint.sh">required Docker entrypoint</a>.</p></li>
            <li>Expand the <b>Docker configuration</b> section. In the <b>Command section</b> you will specify which commands you want to run in this task definition.<p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">Notice the <code>/common/</code> folder specified in the docker command. This is the volume that is specified in the next step. For Container 1, that contains <MadCap:variable name="General.Liquibase" />, to communicate with Container 2, which holds AWS, we need this volume to have access to both of these containers.</p><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/docker-command.png" class="thumbnail" /> </li>
            <li>Expand the <b>Storage</b> section and specify the volume. In this example we are using <code>common_volume</code>.</li>
            <li>Ensure the <b>Volume type</b> is the <b>Bind mount</b>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/volume.png" class="thumbnail" /></li>
            <li>Specify the <b>Container mount points</b> by selecting the <code>Liquibase-Pro</code> container and the source <code>common_volume<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/mount-points.png" class="thumbnail" /></code></li>
            <li>Click the <b>Create</b> button at the bottom of the page to complete mounting the files in Fargate.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/create-task-button.png" class="thumbnail" /><br />Now both of these containers successfully have access to the S3 content because  these mount points are specified. You are ready to run <MadCap:variable name="General.Liquibase" /> commands.</li>
        </ol>
        <h3>Run <MadCap:variable name="General.Liquibase" /> commands</h3>
        <p>Once the configuration files are mounted in Fargate you can begin running <MadCap:variable name="General.Liquibase" /> commands as task definitions.</p>
        <ol>
            <li>Search and select in the AWS&#160;search bar search for the tool of your choice. In this example we are using Amazon Elastic Container Service (ECS) with Fargate.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/ecs.png" class="thumbnail" /></li>
            <li>Navigate to the&#160;<b>Task definitions</b> section on the left side navigation. Here you can define the Task definitions for the <MadCap:variable name="General.Liquibase" /> commands you wish to run.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-def.png" class="thumbnail" /><ol><li><b>Optional:&#160;Place the full image URL in a task definition to extend the Docker image</b><br />You may want to extend your Docker image if you have several services that reuse a common set of configuration options or you use external tools like SQL Plus or SQLCMD. To extend our docker image and add other databases  for a specific task definition, you must use the image URL that displays the ECS&#160;repository. <br /><br />Here is the repository URL that can be extended: <code>709825985650.dkr.ecr.us-east-1.amazonaws.com/liquibase/liquibase/liquibase-pro:<MadCap:variable name="software-versions.latest-liquibase-pro" /></code><br /><p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">You must use the ECS image URL displayed in the task definition to extend our docker image.</p></li><li><p>From the <b>Task definitions</b> section, select a task definition you want to extend the docker image of.</p></li><li><p>Check the box next to the specific definition you want to revise.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/revise-task.png" class="thumbnail" /></p></li><li><p>Click the <b>Create new revision</b> drop down menu and select <b>Create new revision</b>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/create-revision.png" class="thumbnail" /></p></li><li><p>From the Create new revision page you will see the line that starts with image; place the URL here to extend the docker image.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-def-img.png" class="thumbnail" /></p></li></ol></li>
            <li>Run a task definition by selecting the radio button next to the desired definition. In this example we will use update-command.<br /></li>
            <li>Select the <b>Deploy button</b> at the top of the screen.</li>
            <li>From the drop-down menu, select <b>run task</b>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/run-task.png" class="thumbnail" /></li>
            <li>Select the <b>Compute</b> options that you desire. In this example we will toggle Launch type on.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/compute-opts.png" class="thumbnail" /></li>
            <li>Click the <b>Create</b> button.</li>
            <li>AWS will bring you to the tasks in your cluster. You will be able to see the task that is running in the Tasks tab below the Cluster Overview.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/running-task.png" class="thumbnail" /></li>
            <li>Click on the <b>task</b> that is running in the Tasks tab.</li>
            <li>Click on the <b>Logs tab</b> to see all log events on any container you have specified in the Task Definition.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/logs-tab.png" class="thumbnail" /><br />This message will display if you <b>have</b> a license: <MadCap:variable name="General.Liquibase" /> Pro <MadCap:variable name="software-versions.latest-liquibase-pro" /> (license through AWS License Manager)<br />This message will display if you <b>do not have</b> a license:&#160;<MadCap:variable name="General.Liquibase" /> Version: <MadCap:variable name="software-versions.latest-liquibase-pro" /> <br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/license.png" class="thumbnail" /></li>
        </ol>
        <p>You have successfully ran and viewed the logs of a <MadCap:variable name="General.Liquibase" /> command on AWS.</p>
        <h2>Next Steps</h2>
        <p>Now that you've purchased LIquibase on AWS&#160;Marketplace and run commands you may want to add  AWS&#160;Secrets Manager to your AWS workflow. Find instructions for these steps here: <MadCap:xref href="setup-aws-extension.htm">[%=General.Liquibase%] on AWS&#160;with AWS&#160;Secrets Manager</MadCap:xref></p>
    </body>
</html>