<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1><MadCap:variable name="General.Liquibase" /> on AWS&#160;with AWS&#160;Secrets Manager</h1>
        <p>You can use AWS&#160;Secrets Manager within&#160;<MadCap:variable name="General.Liquibase" /> on AWS. This allows you to confidently utilize your AWS&#160;Secrets credentials in a secure way. <br />There are two methods, one is the <b>classpath method</b> and the other is the <b>LPM&#160;method</b>. Find </p>
        <h3>Prerequisites</h3>
        <ul>
            <li>First, purchase a <MadCap:variable name="General.Liquibase" /> license on AWS&#160;by following our <MadCap:xref href="purchase-liquibase-aws.htm">Use [%=General.Liquibase%] on AWS</MadCap:xref> guide.</li>
            <li>
                <MadCap:xref href="../../liquibase-pro/secrets-management/aws-secrets-mgr.htm">AWS Secrets Manager Extension</MadCap:xref>
            </li>
        </ul>
        <h2>Step-by-step</h2>
        <p>Follow these steps until you get to step 10. Then you will choose between the Classpath method and the LPM&#160;method.</p>
        <ol>
            <li>Open your Amazon S3 account.</li>
            <li>Navigate to the S3 bucket that you want to associate with this extension and open it.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/aws-bucket.png" class="thumbnail" /></li>
            <li>Save these files to the <b>S3 bucket</b> and to <b>your local lib folder</b>. These files provide AWS&#160;with your credentials so you can enable AWS&#160;Secrets Manager:<p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">Both <code>liquibasesecrets.docker.properties</code> and <code>liquibase-aws-secrets-manager</code> must be in the same S3 bucket.</p><ol><li><code>liquibasesecrets.docker.properties</code> file</li><li> <code>liquibase-aws-secrets-manager</code> file <br /><p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">You can set your credentials up with the <MadCap:xref href="../../liquibase-pro/secrets-management/aws-secrets-mgr.htm">AWS Secrets Manager Extension</MadCap:xref>.</p></li><br /></ol></li>
            <li>Navigate to Amazon Elastic Container Service on Amazon Marketplace.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/aws-elastic.png" class="thumbnail" /></li>
            <li>Open the <b>Task definitions</b> section from the left navigation menu.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-def-select.png" class="thumbnail" /></li>
            <li>Open a task definition. In this example, we will open the <code><MadCap:variable name="General.changelog" />-sync</code> command.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/changelog-sync-cmd.png" class="thumbnail" /></li>
            <li>Select one of the revisions to open it's details.<p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">In AWS you create revisions of each task definition which include any change made to the definition. You can open any revision and edit it. </p></li>
            <li>Click on the JSON&#160;tab to open the task definition revision's code.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/json-tab.png" class="thumbnail" /></li>
            <li>Click the Create new revision with JSON&#160;button.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/new-rev-json.png" class="thumbnail" /></li>
        </ol>
        <h3>Default  classpath method</h3>
        <ol>
            <li>Replace the <code>liquibase.docker.properties</code> file with the <code>liquibasesecrets.docker.properties</code> file in the JSON code. This provides <MadCap:variable name="General.Liquibase" /> a path to locate the user's credentials that enable them to use the AWS&#160;Secrets Manager.<p><MadCap:codeSnippet><MadCap:codeSnippetCopyButton /><MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: Java;">"command": [
                "--search-path=/common",
                "--defaults-file=/common/liquibasesecrets.docker.properties",
                "changelog-sync",
                "--changelog-file=example-changelog.xml",                
]</MadCap:codeSnippetBody></MadCap:codeSnippet></p></li>
            <li>Add <code>"classpath: /common/liquibase-aws-secrets-manager-1.0.7.jar"</code> at the bottom of the command brackets. This provides <MadCap:variable name="General.Liquibase" /> a path to locate the your credentials that enable you to use the AWS&#160;Secrets Manager.<br /><p><MadCap:codeSnippet><MadCap:codeSnippetCopyButton /><MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: Java;">"command": [
	                "--search-path=/common",
	                "--defaults-file=/common/liquibasesecrets.docker.properties",
	                "changelog-sync",
	                "--changelog-file=example-changelog.xml",
	                "classpath: /common/liquibase-aws-secrets-manager-1.0.7.jar
	]</MadCap:codeSnippetBody></MadCap:codeSnippet></p></li>
            <li>Click the <b>Create</b> button to create the task definition revision.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/create-button.png" class="thumbnail" /></li>
            <li>Click the <b>Deploy</b> drop-down menu and then click the <b>Run task</b> button.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/deploy-run-task.png" class="thumbnail" /><br /></li>
            <li>Select the desired <b>Compute options</b>. In this example we will select <b>Launch Type</b>.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/launch-type.png" class="thumbnail" /></li>
            <li>Click the <b>Create button</b> again to finalize the task definition creation.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/create-button.png" class="thumbnail" /><br />AWS&#160;will bring you to the cluster that contains the task in progress.</li>
            <li>Click on the <b>Tasks</b> tab to view the task running.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-running.png" class="thumbnail" /><br />The task will display a <i>Tasks Launched</i> message when successful.<br />If your task is unsuccessful you can view the task logs to see more details about what did not work as expected.<br /></li>
            <li>Find the task logs by navigating to Clusters, then to the cluster specific to the AWS secrets manager, and then the task that was unsuccessful.<br /><br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-log.png" class="thumbnail" /><br />View the details of the task definition to troubleshoot why the task was unsuccessful.</li>
        </ol>
        <h3>LPM method</h3>
        <ol>
            <li>Replace the JSON&#160;command section of code with this:<MadCap:codeSnippet><MadCap:codeSnippetCopyButton /><MadCap:codeSnippetBody MadCap:useLineNumbers="False" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: Java;">"command": [
				"sh",
                "-c",
                "lpm update &amp;&amp; lpm add liquibase-aws-secrets-manager &amp;&amp; liquibase --search-path=/common --defaults-file=/common/liquibasesecrets.docker.properties changelog-sync --changelog-file=example-changelog.xml --log-level=FINE"
           ]</MadCap:codeSnippetBody></MadCap:codeSnippet><p>This provides <MadCap:variable name="General.Liquibase" /> a direct path to your credentials that enable the use of AWS&#160;Secrets Manager.</p></li>
            <li>Click the <b>Create</b> button to create the task definition revision.<br></br><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/create-button.png" class="thumbnail"></img></li>
            <li>Click the <b>Deploy</b> drop-down menu and then click the <b>Run task</b> button.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/deploy-run-task.png" class="thumbnail" /></li>
            <li>Select the desired <b>Compute options</b>. In this example we will select <b>Launch Type</b>.<br></br><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/launch-type.png" class="thumbnail"></img></li>
            <li>Click the <b>Create button</b> again to finalize the task definition creation.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/create-button.png" class="thumbnail" /><br />AWS&#160;will bring you to the cluster that contains the task in progress.</li>
            <li>Click on the <b>Tasks</b> tab to view the task running.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-running.png" class="thumbnail" /><br />The task will display this message when successful<br />If your task is unsuccessful you can view the task logs to see more details about what did not work as expected.<br /></li>
            <li>Find the task logs by navigating to Clusters, then to the cluster specific to the AWS secrets, and then the task that was unsuccessful.<br />View the details of the task definition to troubleshoot why the task was unsuccessful.</li>
            <li>Find the task logs by navigating to Clusters, then to the cluster specific to the AWS secrets manager, and then the task that was unsuccessful.<br /><img src="../../Z_Resources/Images/Assets/Screenshots/aws-mp/task-log-success.png" class="thumbnail" /><br />View the details of the task definition to troubleshoot why the task was unsuccessful.</li>
        </ol>
    </body>
</html>