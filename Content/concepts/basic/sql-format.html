<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1 id="formatted-sql-changelogs">SQL format</h1>
        <p>As of <MadCap:variable name="General.Liquibase" /> 2.0, <MadCap:variable name="General.Liquibase" /> includes support for “plain SQL” <MadCap:variable name="General.changelog" style="font-style: italic;" /> files. These <MadCap:variable name="General.changelog" style="font-style: italic;" /> may be included from XML <MadCap:variable name="General.changelog" style="font-style: italic;" /> and may contain arbitrary SQL statements. The statements are converted to <a href="../changes/sql.html">custom_sql</a> Change Types.</p>
        <p>Formatted SQL files use comments to provide <MadCap:variable name="General.Liquibase" /> with metadata. Each SQL file must begin with the following comment:</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--liquibase formatted sql</span></code></pre>
        </figure>
        <h2 id="changesets"><MadCap:variable name="General.changeset" style="font-style: italic;" />
        </h2>
        <p>Each <MadCap:variable name="General.changeset" style="font-style: italic;" /> in a formatted SQL file begins with a comment of the form</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--changeset author:id attribute1:value1 attribute2:value2 [...]</span></code></pre>
        </figure>
        <p>The <MadCap:variable name="General.changeset" style="font-style: italic;" /> comment is followed by one or more SQL statements, separated by
semicolons (or the value of the <code class="highlighter-rouge">&lt;endDelimiter&gt;</code> attribute).</p>
        <h3 id="available-changeset-attributes">Available Changeset attributes</h3>
        <p>The following attributes may be provided on each <MadCap:variable name="General.changeset" style="font-style: italic;" />:</p>
        <table>
            <tr>
                <th>Attribute</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>stripComments</td>
                <td>Set to true to remove any comments in the SQL before executing, otherwise false. Defaults to true if not set</td>
            </tr>
            <tr>
                <td>splitStatements</td>
                <td>Set to false to not have <MadCap:variable name="General.Liquibase" /> split statements on ;'s and GO's. Defaults to true if not set</td>
            </tr>
            <tr>
                <td>rollbackSplitStatements</td>
                <td>Same as splitStatements but for rollback SQL</td>
            </tr>
            <tr>
                <td>endDelimiter</td>
                <td>Delimiter to apply to the end of the statement. Defaults to ";", may be set to "".</td>
            </tr>
            <tr>
                <td>rollbackEndDelimiter</td>
                <td>Same as endDelimiter but for rollback SQL</td>
            </tr>
            <tr>
                <td>runAlways</td>
                <td>Executes the <MadCap:variable name="General.changeset" style="font-style: italic;" /> on every run, even if it has been run before </td>
            </tr>
            <tr>
                <td>runOnChange</td>
                <td>Executes the change the first time it is seen and each time the change set has been changed </td>
            </tr>
            <tr>
                <td>context</td>
                <td>Executes the change if the particular context was passed at runtime. Any string can be used for the context name and they are checked case-insensitively. </td>
            </tr>
            <tr>
                <td>logicalFilePath</td>
                <td>Use to override the file name and path when creating the unique identifier of <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i>. Required when moving or renaming change logs. </td>
            </tr>
            <tr>
                <td>labels</td>
                <td>Labels are general purpose way to categorize <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> like contexts, but working in the opposite way. Instead of defining a set of contexts at runtime and then a match expression in the <MadCap:variable name="General.changeset" style="font-style: italic;" />, you define a set of labels in the context and a match expression at runtime. </td>
            </tr>
            <tr>
                <td>runInTransaction</td>
                <td>Should the <MadCap:variable name="General.changeset" style="font-style: italic;" /> be ran as a single transaction (if possible)? Defaults to true.  <b>Warning: be careful with this attribute. If set to false and an error occurs part way through running a <MadCap:variable name="General.changeset" style="font-style: italic;" /> containing multiple statements, the <MadCap:variable name="General.Liquibase" /> <MadCap:variable name="General.databasechangelog" /> table will be left in an invalid state</b> </td>
            </tr>
            <tr>
                <td>failOnError</td>
                <td>Should the migration fail if an error occurs while executing the <MadCap:variable name="General.changeset" style="font-style: italic;" />? </td>
            </tr>
            <tr>
                <td>dbms</td>
                <td>The type of a database which that <MadCap:variable name="General.changeset" style="font-style: italic;" /> is to be used for. When the migration step is running, it checks the database type against this 
 attribute. Valid database type names are listed on the <a href="../../databases.html">supported databases page</a>. It is possible to list multiple databases separated by commas. 
 You can also specify that a <MadCap:variable name="General.changeset" style="font-style: italic;" /> is <b>NOT</b> applicable to a particular database type by prefixing with <code>!</code>. The keywords <code>all</code> and <code>none</code> are 
 also available.</td>
            </tr>
            <tr>
                <td>logicalFilePath</td>
                <td>Sets a logical file path in <MadCap:variable name="General.databasechangelog" /> table instead of physical file location of SQL where the <MadCap:variable name="General.Liquibase" /> executed.</td>
            </tr>
        </table>
        <h2 id="preconditions">Preconditions</h2>
        <p>Preconditions can be specified for each <MadCap:variable name="General.changeset" style="font-style: italic;" />. Currently, only the SQL Check precondition is supported.</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--preconditions onFail:HALT onError:HALT</span>  
<span class="c1">--precondition-sql-check expectedResult:0 SELECT COUNT(*) FROM my_table</span></code></pre>
        </figure>
        <h2 id="rollback-actions">Rollback actions</h2>
        <p><MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> may include statements to be applied when rolling back the <MadCap:variable name="General.changeset" style="font-style: italic;" />. Rollback statements are comments of the form</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--rollback SQL STATEMENT</span></code></pre>
        </figure>
        <h2 id="comment">Comment</h2>
        <p>A description of the<MadCap:variable name="General.changeset" style="font-style: italic;" />. Future releases of <MadCap:variable name="General.Liquibase" /> may be able to make use of comments to generate documentation.</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--comment: Some comment</span></code></pre>
        </figure>
        <h2 id="valid-checksum">Valid CheckSum</h2>
        <p>Checksum which are considered valid for this <MadCap:variable name="General.changeset" style="font-style: italic;" />, regardless of what is stored in the database. Used primarily when you need to change a <MadCap:variable name="General.changeset" style="font-style: italic;" /> and don’t want errors thrown on databases on which it has already run (not a recommended procedure).<b>Since 3.5</b></p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--validCheckSum: 3:098f6bcd4621d373cade4e832627b4f6</span>  
<span class="c1">--validCheckSum: 7:ad0234829205b9033196ba818f7a872b</span></code></pre>
        </figure>
        <h2 id="ignore-lines">Ignore lines</h2>
        <p>Allow to ignore some lines. Useful when using same script with other SQL tool.
<b>Since 3.7</b></p>
        <p>Mark two lines to be ignored:</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--changeset author:id1</span>  
<span class="k">CREATE</span>  <span class="k">OR</span>  <span class="k">REPLACE</span>  <span class="n">PACKAGE</span>  <span class="p">...</span>  
<span class="c1">--ignoreLines:2</span>  
<span class="o">/</span>  
<span class="k">show</span>  <span class="n">errors</span><span class="p">;</span>  
<span class="c1">--changeset author:id2</span>  
<span class="k">CREATE</span>  <span class="k">OR</span>  <span class="k">REPLACE</span>  <span class="n">PACKAGE</span>  <span class="n">BODY</span>  <span class="p">...</span></code></pre>
        </figure>
        <p>Same effect using start-end syntax:</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--changeset author:id1</span>  
<span class="k">CREATE</span>  <span class="k">OR</span>  <span class="k">REPLACE</span>  <span class="n">PACKAGE</span>  <span class="p">...</span>  
<span class="c1">--ignoreLines:start</span>  
<span class="o">/</span>  
<span class="k">show</span>  <span class="n">errors</span><span class="p">;</span>  
<span class="c1">--ignoreLines:end</span>  
<span class="c1">--changeset author:id2</span>  
<span class="k">CREATE</span>  <span class="k">OR</span>  <span class="k">REPLACE</span>  <span class="n">PACKAGE</span>  <span class="n">BODY</span>  <span class="p">...</span></code></pre>
        </figure>
        <h2 id="sample-change-log">Sample <MadCap:variable name="General.changelog" style="font-style: italic;" /></h2>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-sql" data-lang="sql"><span class="c1">--liquibase formatted sql</span>  

<span class="c1">--changeset nvoxland:1</span>  
<span class="k">create</span>  <span class="k">table</span>  <span class="n">test1</span>  <span class="p">(</span>  
    <span class="n">id</span>  <span class="n">int</span>  <span class="k">primary</span>  <span class="k">key</span><span class="p">,</span>  
    <span class="n">name</span>  <span class="n">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>  
<span class="p">);</span>  
<span class="c1">--rollback drop table test1;</span>  

<span class="c1">--changeset nvoxland:2</span>  
<span class="k">insert</span>  <span class="k">into</span>  <span class="n">test1</span>  <span class="p">(</span><span class="n">id</span><span class="p">,</span>  <span class="n">name</span><span class="p">)</span>  <span class="k">values</span>  <span class="p">(</span><span class="mi">1</span><span class="p">,</span>  <span class="err">‘</span><span class="n">name</span>  <span class="mi">1</span><span class="err">′</span><span class="p">);</span>  
<span class="k">insert</span>  <span class="k">into</span>  <span class="n">test1</span>  <span class="p">(</span><span class="n">id</span><span class="p">,</span>  <span class="n">name</span><span class="p">)</span>  <span class="k">values</span>  <span class="p">(</span><span class="mi">2</span><span class="p">,</span>  <span class="err">‘</span><span class="n">name</span>  <span class="mi">2</span><span class="err">′</span><span class="p">);</span>  

<span class="c1">--changeset nvoxland:3 dbms:oracle</span>  
<span class="k">create</span>  <span class="n">sequence</span>  <span class="n">seq_test</span><span class="p">;</span></code></pre>
        </figure>
    </body>
</html>