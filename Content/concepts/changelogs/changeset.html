<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <meta rel="canonical" href="https://docs.liquibase.com/concepts/changelogs/changeset.html" />
        <meta name="description" content="Reference information for using changesets in Liquibase. Changesets allow you to group database change types together and is a unit of change that Liquibase executes on a database." />
    </head>
    <body>
        <h1 id="changeset-tag">Changeset</h1>
        <p>A <MadCap:variable name="General.changeset" /> is the basic unit of change in <MadCap:variable name="General.Liquibase" />. You store all your <MadCap:variable name="General.changeset" />s in your <MadCap:xref href="home.html">Changelog</MadCap:xref>. Your <MadCap:variable name="General.changeset" />s contain <MadCap:xref href="../../change-types/home.html">[%=General.changetypes%]s</MadCap:xref> that specify what each change does, like creating a new table or adding a column to an existing table.</p>
        <p>A <MadCap:variable name="General.changeset" /> is uniquely tagged by both the <code>author</code> and <code>id</code> <MadCap:variable name="General.Param/Attribute" />s (<code>author:id</code>), as well as the <MadCap:variable name="General.changelog" /> file path.  The <code>id</code> tag is just an identifier—it doesn't direct the order that changes are run and doesn't have to be an integer. To deploy the <MadCap:variable name="General.changeset" /> with the <MadCap:xref href="../../commands/update/update.html">update</MadCap:xref> command, you must include both <code>author</code> and <code>id</code>. You can specify <MadCap:xref href="preconditions.html">Preconditions</MadCap:xref>, <MadCap:xref href="attributes/contexts.html">Contexts</MadCap:xref>, <MadCap:xref href="attributes/labels.html">Labels</MadCap:xref>, and other <MadCap:variable name="General.Param/Attribute" /> in individual <MadCap:variable name="General.changeset" />s to control exactly when they run.</p>
        <p>It is a best practice to specify only one type of change per <MadCap:variable name="General.changeset" />. When you deploy your changes, each <MadCap:variable name="General.changeset" /> either succeeds or fails; if it fails, you can correct it and deploy again. You can also add comments to individual <MadCap:variable name="General.changeset" />s to explain why they're important.</p>
        <h2>File formats</h2>
        <p>The format of your <MadCap:variable name="General.changeset" /> depends on the file type of your <MadCap:variable name="General.changelog" />, which can be SQL, XML, YAML, or JSON. For examples of entire <MadCap:variable name="General.changelog" />s in each format, see the following pages:</p>
        <ul>
            <li>
                <MadCap:xref href="sql-format.html">Example Changelogs: SQL Format</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="xml-format.html">Example Changelogs: XML Format</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="json-format.html">Example Changelogs: JSON Format</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="yaml-format.html">Example Changelogs:  YAML Format</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="other-formats.html">Example Changelogs: Other Formats</MadCap:xref>
            </li>
        </ul>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-size: 1.1em;">SQL example</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre xml:space="preserve"><code class="language-sql" data-lang="sql">--changeset nvoxland:1
create table company (
    id int primary key,
    address varchar(255)
);</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-size: 1.1em;">XML example</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre xml:space="preserve"><code class="language-xml" data-lang="xml">&lt;changeSet  id="1"  author="nvoxland"&gt;
    &lt;createTable  tableName="company"&gt;
        &lt;column  name="address"  type="varchar(255)"/&gt;
    &lt;/createTable&gt;
&lt;/changeSet&gt;</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-size: 1.1em;">YAML example</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre xml:space="preserve"><code class="language-yaml" data-lang="yaml">databaseChangeLog:
  -  changeSet:  
      id:  1
      author:  nvoxland
      changes:
        -  createTable:
            tableName:  company
            columns:
              -  column:
                  name:  address</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-size: 1.1em;">JSON example</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre xml:space="preserve"><code class="language-json">{
  "changeSet": {
    "id": "1",
    "author": "nvoxland",
    "changes": [
      {
        "createTable": {
          "tableName": "company",
          "columns": [
            {
              "column": {
                "name": "address"
              }
            }
          ]
        }
      }
    ]
  }
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <h2>Runtime logic</h2>
        <p>At runtime, <MadCap:variable name="General.Liquibase" /> reads the <MadCap:variable name="General.changeset" />s in order. For each one, it checks the <MadCap:xref href="../tracking-tables/databasechangelog-table.html">[%=General.databasechangelog%] table</MadCap:xref> to see if the combination of <code>id/author/filepath</code> has already been deployed.</p>
        <p>If the <MadCap:variable name="General.changeset" /> has already been run, <MadCap:variable name="General.Liquibase" /> skips it unless there is a <code>runAlways=true</code> tag  in that <MadCap:variable name="General.changeset" />. After running all the changes in the <MadCap:variable name="General.changeset" />s, <MadCap:variable name="General.Liquibase" /> inserts a new row with the <code>id/author/filepath</code> along with an MD5Sum of the <MadCap:variable name="General.changeset" /> in the <MadCap:variable name="General.databasechangelog" />.</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;"> <i>filepath</i> is the path that defines the <code>changelog-file</code> <MadCap:variable name="General.Param/Attribute" />. Even if the same file is referenced with a different path, that is considered a different file unless the <code>logicalFilePath</code> is defined.</p>
        <p><MadCap:variable name="General.Liquibase" /> attempts to execute each <MadCap:variable name="General.changeset" /> in a transaction that is committed at the end, or rolled back if there is an error. Some databases auto-commit statements, which interferes with this transaction setup and could lead to an unexpected database state. Therefore, it is best practice to have just one change per <MadCap:variable name="General.changeset" /> unless there is a group of non-auto-committing changes that you want to apply as a transaction such as inserting data.</p>
        <h2 id="available-attributes"><MadCap:variable name="General.Param/Attribute" />s</h2>
        <MadCap:snippetBlock src="../../Z_Resources/Snippets/text/changelog-changeset-attributes.flsnp" />
        <h2><MadCap:variable name="General.changeset" /> checksums</h2>
        <p>When <MadCap:variable name="General.Liquibase" /> reaches a <MadCap:variable name="General.changeset" />, it computes a checksum and stores it in the <MadCap:variable name="General.databasechangelog" /> table. The value of storing the checksum for <MadCap:variable name="General.Liquibase" /> is to know if 
something has been changed  in the <MadCap:variable name="General.changeset" /> since it was run.</p>
        <p>If the <MadCap:variable name="General.changeset" /> has been changed since it was run, <MadCap:variable name="General.Liquibase" /> will exit the migration with an error message like:</p><pre xml:space="preserve"><code class="language-text">Validation Failed:
 1 change sets check sum
com/example/changelog.xml::1::example was: 8:63f82d4ff1b9dfa113739b7f362bd37d but is now: 8:b4fd16a20425fe377b00d81df722d604</code></pre>
        <p>In this example, <code>com/example/changelog.xml::1::example</code> is the <MadCap:variable name="General.changeset" /> identifier, <code>8:63f…</code> is the old checksum, and <code>8:b4f…</code> is the new checksum.</p>
        <p>This message displays because <MadCap:variable name="General.Liquibase" /> cannot identify what was changed and the 
database may be in a state different than what the <MadCap:variable name="General.changelog" /> is expecting. If there was a valid reason for the <MadCap:variable name="General.changeset" /> to be changed and you want to ignore this error, there are two options.</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">You can also use the <MadCap:xref href="../../commands/maintenance/clear-checksums.htm">clear-checksums</MadCap:xref> command to resolve the checksum error, however, it will clear the entire column of checksums in your <MadCap:variable name="General.databasechangelog" /> table.</p>
        <h3>Manual update of the <MadCap:variable name="General.databasechangelog" /> table</h3>
        <p>The first option is to manually update the <MadCap:variable name="General.databasechangelog" /> table so that the row with the corresponding <code>id/author/filepath</code> has a null value for the checksum. You would 
need to do this for all environments where the <MadCap:variable name="General.changeset" /> has been deployed. The next time you run the <MadCap:variable name="General.Liquibase" /> <code>update</code> command, it will update the checksum value to the new correct value.</p>
        <h3><code class="highlighter-rouge">&lt;validCheckSum&gt;</code>&#160;<MadCap:variable name="General.Param/Attribute" /></h3>
        <p>The second option is to add a <code class="highlighter-rouge">&lt;validCheckSum&gt;</code> element to the <MadCap:variable name="General.changeset" />. The text contents of the element should contain the new checksum from the error message. For example:</p><pre xml:space="preserve"><code class="language-xml">&lt;changeSet id="1" author="example"&gt;
    &lt;validCheckSum&gt;8:b4fd16a20425fe377b00d81df722d604&lt;/validCheckSum&gt;
    &lt;addColumn tableName="my_table"&gt;
        &lt;column name="my_column" type="BIGINT"/&gt;
    &lt;/addColumn&gt;
&lt;/changeSet&gt;</code></pre>
        <h3><code>runOnChange</code>&#160;<MadCap:variable name="General.Param/Attribute" /></h3>
        <p>Checksums are also used in conjunction with the <code>runOnChange</code> <MadCap:variable name="General.changeset" /> <MadCap:variable name="General.Param/Attribute" />. There are times you may not want to add a new <MadCap:variable name="General.changeset" /> because you only need to know 
about the current version, but you want this change to be applied whenever it is updated. For example, you can do this with stored procedures.</p>
        <p>If you copy the entire 
text of the stored procedure to a new <MadCap:variable name="General.changeset" /> each time you make a change, you will not only end up with a very long <MadCap:variable name="General.changelog" />, but you will lose the merging and diffing 
power of your source control. Instead, put the text of the stored procedure in a <MadCap:variable name="General.changeset" /> with a <code>runOnChange="true"</code> <MadCap:variable name="General.Param/Attribute" />. The stored procedure will be re-created 
when there is a change to the text of it.</p>
        <p class="note" MadCap:autonum="&lt;b&gt;Note: &lt;/b&gt;">For more information, see <MadCap:xref href="attributes/runonchange.htm">runOnChange</MadCap:xref>.</p>
        <h2>Related links</h2>
        <ul>
            <li><a href="https://www.liquibase.org/blog/dealing-with-changing-changesets">Dealing with Changing Changesets</a>
            </li>
            <li><a href="https://www.liquibase.com/blog/what-affects-changeset-checksums">All About Changeset Checksums</a>
            </li>
            <li>
                <MadCap:xref href="../../parameters/home.htm">[%=General.Liquibase%] Parameters</MadCap:xref>
            </li>
        </ul>
    </body>
</html>