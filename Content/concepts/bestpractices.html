<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title>Best Practices | Liquibase Docs</title>
        <meta rel="canonical" href="https://docs.liquibase.com/concepts/bestpractices.html" />
        <meta name="description" content="This page contains a list of best practices to follow when using Liquibase." />
    </head>
    <body>
        <h1 id="liquibase-best-practices"><MadCap:variable name="General.Liquibase" /> Best Practices</h1>
        <p>To help you maximize the effectiveness and efficiency of the <MadCap:variable name="General.Liquibase" /> workflow, we recommend that you implement the following best practices.</p>
        <h2 id="organizing-your-changelogs">Changelogs</h2>
        <ul>
            <li>
                <p>Define the directory structure.</p>
                <p>The most common way to organize your changelogs is by major release. Make certain to store changelogs in your source control, preferably near the database access code.</p>
                <p>The following example specifies the directory <code>com/example/db/changelog</code>.</p>
                <figure class="highlight"><pre xml:space="preserve"><code class="language-text" data-lang="text">com
  example
    db
      changelog
        db.changelog-main.xml
		db.changelog-1.0.xml
		db.changelog-1.1.xml
		db.changelog-2.0.xml
	  DatabasePool.java
	  AbstractDAO.java</code>
						</pre>
                </figure>
            </li>
            <li>
                <p>Set up the root changelog and the included changelog files.</p>
                <p>The root changelog file <code>db.changelog-root.xml</code> is passed to all <MadCap:variable name="General.Liquibase" /> calls.</p>
                <p><MadCap:variable name="General.Liquibase" /> supports the inclusion of changelogs in the following formats:</p>
                <ul>
                    <li>SQL – Use SQL if you are familiar with it and do not want to learn a new way to specify database changes.</li>
                    <li>Markup – Use a markup language like XML, JSON, or YAML to accomplish any of the following tasks:
                        <ul><li>Automate the rollback of new database objects</li><li>Simplify the deployment a single set of changes to different types of databases</li><li>Improve Hub and DBDoc reporting</li></ul><p>When new version files are created, update <code>db.changelog-root.xml</code> with the new include files.</p><!--p>To view example changelogs in different languages, see "link to a (yet to be created) page with tabbed, dynamic examples of the different changelog formats, à la the GS examples or LB.org’s Best Practices".</p--></li>
                </ul>
            </li>
            <li>Specify one change per changeset.
				<p>Unless you are grouping several changes as a single transaction, we strongly encourage you to specify only one change per changeset. This approach makes each change atomic within a single transaction.</p><p>Each changeset either succeeds or fails. If it fails, it can be corrected and redeployed until it succeeds. Multiple independent changes in a single changeset introduce the risk that some changes deploy while a later change fails, leaving the database in a partially deployed state.</p></li>
            <li>
                <p>Define the team's changeset ID format.</p>
                <p>Choose a changeset ID that is unique within its changelog. We recommend that you use an increasing numerical sequence that starts at 1.</p>
            </li>
            <li>
                <p>Document unclear or complicated changesets.</p>
                <p>Most of the time, changesets are self-documenting. When a changeset requires additional information or explanation, use <code>&lt;comments&gt;</code> tags.</p>
            </li>
            <li>
                <p>Plan a rollback strategy.</p>
                <p>Use the mechanism for your specific changelog format to explicitly state your rollback instructions. Make certain to test your rollback logic early during the planning process.</p>
                <p>To ensure safe and predictable rollbacks, test them in a development environment before running them in production.</p>
            </li>
            <li>
                <p>Manage your reference data.</p>
                <p>Leverage <MadCap:variable name="General.Liquibase" /> to manage your reference data. For example, <MadCap:variable name="General.Liquibase" /> contexts help you target specific environments when you need to complete the following tasks:</p>
                <ul>
                    <li>
                        <p>Deploy test data to QA environments only</p>
                    </li>
                    <li>
                        <p>Deploy data fixes to pre-production and production environments</p>
                    </li>
                    <li>
                        <p>Manage application configuration data</p>
                    </li>
                </ul>
            </li>
        </ul>
        <h2 id="stored-logic">Stored Logic</h2>
        <p>After a changeset is applied to an environment, <MadCap:variable name="General.Liquibase" /> never applies the same changeset to that same environment unless you override its default values. When you use Liquibase to update stored logic objects like procedures and functions, the following options are available:</p>
        <ul>
            <li>Add <code>roll forward</code> changesets to the end of the changelog.
				<p><b>Note:</b> This approach might create multiple changesets in the changelog. Additionally, multiple files might be required to manage the various states of the stored logic objects.</p></li>
            <li><i>Recommended:</i> Maintain a separate, stored logic-specific changelog file that satisfies the following criteria:
				<ul><li>Features a generic name, like <code>changelog-rerunable.xml</code></li><li>Always runs last during the run order</li></ul></li>
        </ul>
        <p>When stored logic objects reside within a separate changelog, you do not need to revisit earlier release files every time an object changes. By running the changelog at the end of the run order, the stored logic objects remain outside the typical flow, reducing the chance of encountering an error.</p>
        <p>Stored logic behaves more like application code than a database schema change. Stored procedures, functions, packages, and triggers are better managed similarly to source code, where continuous updates are made to a single source file for each unit of stored logic. Use this approach with standard Git tools to detect changes over time.</p>
        <p>To deploy changes only when a changelog file is modified, ensure the following criteria are satisfied:</p>
        <ul>
            <li>Your stored logic includes a <code>CREATE OR REPLACE</code> statement.
			<p><b>Note:</b> If your database does not support <code>CREATE OR REPLACE</code>, you might need to explicitly drop an object, if it exists, and follow it up with a separate <code>CREATE</code> statement.</p></li>
            <li>The changeset attribute <code>runOnChange</code> is set to <code>"true"</code>.</li>
        </ul>
        <p>When Liquibase detects a modification to a stored logic changeset that was applied during a previous update, it uses the new object definition to apply the changeset again.</p>
        <!--h3 id="dbchangelog-mainxml"><code>db.changelog-main.xml</code>
        </h3>
        <p><code>main.xml</code> includes the <MadCap:variable name="General.changelog" style="font-style: italic;" /> for the releases in the correct order. In the example above, it could look like this:</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;   
&lt;databaseChangeLog  
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"  
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
  xmlns:pro="http://www.liquibase.org/xml/ns/pro"				
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.7.xsd
  http://www.liquibase.org/xml/ns/pro 
  http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.7.xsd"&gt;
  &lt;include  file="com/example/db/changelog/db.changelog-1.0.xml"/&gt;   
  &lt;include  file="com/example/db/changelog/db.changelog-1.1.xml"/&gt;   
  &lt;include  file="com/example/db/changelog/db.changelog-2.0.xml"/&gt;   
&lt;/databaseChangeLog&gt; </code>
            </pre>
        </figure>
        <p>Each of the included XML files needs to be in the same format as a standard XML database <MadCap:variable name="General.changelog" style="font-style: italic;" />:</p>
        <figure class="highlight"><pre xml:space="preserve"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;   
&lt;databaseChangeLog   
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"   
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:pro="http://www.liquibase.org/xml/ns/pro"					  
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.7.xsd
  http://www.liquibase.org/xml/ns/pro 
  http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.7.xsd"&gt;   
  &lt;changeSet  author="authorName"  id="changelog-1.0"&gt;  
    &lt;createTable  tableName="TablesAndTables"&gt;  
      &lt;column  name="COLUMN1"  type="TEXT"&gt;  
        &lt;constraints  nullable="true"  primaryKey="false"  unique="false"/&gt;  
      &lt;/column&gt;  
    &lt;/createTable&gt;  
  &lt;/changeSet&gt;  
&lt;/databaseChangeLog&gt; </code>
            </pre>
        </figure>
        <p><code>db.changelog-main.xml</code> is the <MadCap:variable name="General.changelog" style="font-style: italic;" /> you pass to all <MadCap:variable name="General.Liquibase" /> calls.</p>
        <h3 id="managing-stored-procedures">Managing stored procedures</h3>
        <p>Try to maintain separate <MadCap:variable name="General.changelog" style="font-style: italic;" /> for Stored Procedures and use <code>runOnChange="true"</code>. This flag forces <MadCap:variable name="General.Liquibase" /> to check if the <MadCap:variable name="General.changeset" style="font-style: italic;" /> was modified. If so, <MadCap:variable name="General.Liquibase" /> executes the change again.</p>
        <h3 id="one-change-per-changeset">One change per <MadCap:variable name="General.changeset" /></h3>
        <p>Only make one change per <MadCap:variable name="General.changeset" style="font-style: italic;" />. This prevents failed auto-commit statements that can leave the database in an unexpected state.</p>
        <h2 id="changeset-ids"><MadCap:variable name="General.changeset" style="font-style: italic;" /> ids</h2>
        <p>Choose what works for you. For example, you can use a sequence number starting from 1 and unique within the <MadCap:variable name="General.changelog" style="font-style: italic;" />, or you can use a descriptive name like "new-address-table."</p>
        <h2 id="document-changesets">Document <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i></h2>
        <p>Use <code class="highlighter-rouge">&lt;comments&gt;</code> in the <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i>.This makes it easier to manage large <MadCap:variable name="General.changelog" style="font-style: italic;" /><i>s</i>.</p>
        <h2 id="always-think-about-rollback">Always think about rollback</h2>
        <p>Try to write <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> in a way that they can be rolled back. For example, use a relevant change clause instead of using custom <code class="highlighter-rouge">&lt;sql&gt;</code> tag.
Include a <code class="highlighter-rouge">&lt;rollback&gt;</code> clause whenever a change doesn't support out-of-box rollback. (such as <code class="highlighter-rouge">&lt;sql&gt;</code>, <code class="highlighter-rouge">&lt;insert&gt;</code>, etc).</p>
        <h2 id="reference-data-management">Reference data management</h2>
        <p>Leverage <MadCap:variable name="General.Liquibase" /> to manage your Reference Data. You can achieve environment separation (DEV, QA, PROD) using <code>context</code>. See <MadCap:xref href="changelogs/attributes/contexts.html">Contexts</MadCap:xref> to learn more.</p>
        <h2 id="procedure-for-the-developer">Procedure for the developer</h2>
        <ul>
            <li>Using your favorite IDE or editor, create a new local <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> containing the change.</li>
            <li>Run <MadCap:variable name="General.Liquibase" /> to execute the new <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> (this tests the SQL code).</li>
            <li>Perform the corresponding changes in the application code (for example, Java code).</li>
            <li>Test the new application code together with the database change.</li>
            <li>Commit both <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> and the application code.</li>
        </ul>
        <h2 id="consider-liquibase-pro-or-datical">Consider <MadCap:variable name="General.LBPro" /> or <MadCap:variable name="General.LBEnterprise" /></h2>
        <h3 id="liquibase-pro"><MadCap:variable name="General.LBPro" />
        </h3>
        <p><a href="https://download.liquibase.org/" target="_blank"><MadCap:variable name="General.LBPro" /></a> offers an extra layer of support so you don't have to go it alone. While <MadCap:variable name="General.Liquibase" /> is a great starting point, teams that want best practices on how to make the most of <MadCap:variable name="General.Liquibase" /> may find <MadCap:variable name="General.LBPro" /> better suited to their needs. <MadCap:variable name="General.LBPro" /> also adds features like <a href="../commands/rollbackonechangeset.html">Targeted Rollback</a> and the ability to work with <a href="https://www.liquibase.org/documentation/changes/index.html">Stored Logic</a>.</p>
        <h3 id="datical"><MadCap:variable name="General.LBEnterprise" />
        </h3>
        <p><MadCap:variable name="General.LBEnterprise" /> is a commercial product which builds on the core <MadCap:variable name="General.Liquibase" /> functionality. Beyond versioning and managing database changes, <MadCap:variable name="General.LBEnterprise" /> bridges the gap between development and operations with capabilities that enable a fully unified and automated path for database code.</p>
        <ul>
            <li><MadCap:variable name="General.LBEnterprise" /> has a web interface, command line interface, and REST API. All interfaces are secure and require authentication.</li>
            <li><MadCap:variable name="General.LBEnterprise" /> automatically verifies database code against organizational standards to eliminate manual review.</li>
            <li><MadCap:variable name="General.LBEnterprise" /> automatically generates <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> from validated DDL code, eliminating manual effort in crafting <MadCap:variable name="General.changeset" style="font-style: italic;" /><i>s</i> and manually updating the <MadCap:variable name="General.changelog" />.</li>
            <li><MadCap:variable name="General.LBEnterprise" /> generates an immutable artifact for database code for consistent, repeatable, and automation-ready downstream deployments.</li>
            <li><MadCap:variable name="General.LBEnterprise" /> forecasts the impact of database changes with an object-based model of the target database to ensure that there are no errors or issues when deploying database changes.</li>
            <li><MadCap:variable name="General.LBEnterprise" /> integrates with ticketing systems like JIRA to make it easy to trace database changes back to source code and initial requirements. This same capability also makes it easy to hold or accelerate feature sets.</li>
            <li><MadCap:variable name="General.LBEnterprise" /> can snapshot and compare database schemas to help identify and address drift.</li>
        </ul>
        <p>For more information on <MadCap:variable name="General.LBEnterprise" />, visit <a href="https://www.liquibase.com/">www.liquibase.com</a>.</p-->
    </body>
</html>