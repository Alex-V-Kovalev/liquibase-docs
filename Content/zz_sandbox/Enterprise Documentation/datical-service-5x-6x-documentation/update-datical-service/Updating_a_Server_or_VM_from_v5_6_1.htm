<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title></title>
    </head>
    <body>
        <h1>Updating a Server or VM from v5.6.1</h1>
        <p />
        <div class="toc-macro client-side-toc-macro  conf-macro output-block">
        </div>
        <p>Use these instructions to update a previously installed instance of Datical Service v5.6.1 running on a physical server or in a VM.&#160;</p>
        <div class="confluence-information-macro confluence-information-macro-information conf-macro output-block">
            <div class="confluence-information-macro-body">
                <p>If you are currently running v5.3, See&#160;<a href="Migrate_v5_3_and_Update_on_Existing_Host.htm">Migrate v5.3 and Update on Existing Host</a> or&#160;<a href="Migrate_v5_3_to_Different_Host_and_Update.htm">Migrate v5.3 to Different Host and Update</a>.&#160;</p>
            </div>
        </div>
        <h1 id="UpdatingaServerorVMfromv5.6.1-Prerequisites">Prerequisites</h1>
        <h2 id="UpdatingaServerorVMfromv5.6.1-InternetAccessPrerequisite">Internet Access Prerequisite</h2>
        <p>The upgrade instructions are written for the case where the Datical Service host is not connected to the Internet.</p>
        <p>During upgrade, you download files to an internet-connected host, then move them to the Datical Service host.&#160;</p>
        <p>The host you use for needs the following capabilities:</p>
        <ul>
            <li>It has access to <a class="external-link" href="http://software.datical.com" rel="nofollow">software.datical.com</a> through the internet in order to download files.</li>
            <li>It has access to the Datical Service host in order to move the downloaded files into position for upgrade.</li>
        </ul>
        <h2 id="UpdatingaServerorVMfromv5.6.1-LoginPrerequisite">Login Prerequisite</h2>
        <p>When you log in to the Datical Service host, log in as the Datical Service user. It is datical unless you set the system up to use a different one.</p>
        <h2 id="UpdatingaServerorVMfromv5.6.1-SpacePrerequisite">Space Prerequisite</h2>
        <p>Check that the following directories have sufficient space.&#160;</p>
        <ul>
            <li>Download directory on the internet-connected host: 10 GB</li>
            <li>Datical Service host - the <code>/opt/datical</code> area: 20 GB</li>
        </ul>
        <h1 id="UpdatingaServerorVMfromv5.6.1-BackUpandPrepareDaticalService">Back Up and Prepare Datical Service</h1>
        <p>Make the existing Datical Service host ready for upgrade.</p>
        <ol>
            <li>
                <p class="auto-cursor-target">Run the following command to back up Datical Service.&#160;</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">datical-control backup all</pre>
                    </div>
                </div>
            </li>
            <li>
                <p class="auto-cursor-target">Turn off updates.&#160;</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">sudo datical-control versions mark-offline</pre>
                    </div>
                </div>
            </li>
        </ol>
        <h1 id="UpdatingaServerorVMfromv5.6.1-DownloadFilesfortheNewVersion">Download Files for the New Version</h1>
        <p>On an internet-connected host machine or from a VM command shell, download the files.&#160;</p>
        <ol>
            <li>
                <p class="auto-cursor-target">Create a directory to contain <em>only</em> the files you download.</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">mkdir /tmp/datical59</pre>
                    </div>
                </div>
            </li>
            <li>Log in to <code><a class="external-link" href="http://software.datical.com" rel="nofollow">software.datical.com</a></code>.&#160; Contact our Technical Support team if you need assistance with credentials.</li>
            <li>Go to the directory containing the Datical Service files.&#160;<br /><br /><strong>COMMON &gt; Datical_Service_Software &gt; Datical_Service_v5.9<br /><br /></strong></li>
            <li>
                <p class="auto-cursor-target">Download the Datical Service <code>.part</code> files to <code>/tmp/datical59</code></p>
                <ul>
                    <li>
                        <p class="auto-cursor-target"><em>Optional</em>: Download the files for the Jenkins-based internal client. Go to the <strong>jenkins</strong> subdirectory and download the <code>.part</code> files to <code>/tmp/datical59</code>.&#160;</p>
                    </li>
                </ul>
            </li>
            <li>
                <p class="auto-cursor-target">Move the downloaded <code>.part</code> files to the Datical Service host. Place them in the following directory:</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">/opt/datical/install-files</pre>
                    </div>
                </div>
            </li>
        </ol>
        <h1 id="UpdatingaServerorVMfromv5.6.1-ExtracttheDaticalServicePartFiles">Extract the Datical Service Part Files</h1>
        <p>On the Datical Service host, do the following.</p>
        <ul>
            <li>
                <p class="auto-cursor-target">Extract only the Datical Service files. Do not extract the Jenkins <code>.part</code> files.&#160;</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">cat /opt/datical/install-files/datical-service-*.part* | sudo tar xfv - -C /opt/datical</pre>
                    </div>
                </div>
            </li>
        </ul>
        <h1 id="UpdatingaServerorVMfromv5.6.1-CreateRepositoryfortheUpgrade">Create Repository for the Upgrade</h1>
        <ol>
            <li>
                <p class="auto-cursor-target">Create the repository.</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">sudo createrepo /opt/datical/data-clustered/rpm</pre>
                    </div>
                </div>
            </li>
            <li>
                <p class="auto-cursor-target">Clear cache.</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">sudo yum makecache clean all</pre>
                    </div>
                </div>
            </li>
        </ol>
        <h1 id="UpdatingaServerorVMfromv5.6.1-RuntheUpdateScript">Run the Update Script</h1>
        <p>Run the following script:<br /><br /></p>
        <div class="preformatted panel conf-macro output-block" style="border-width: 1px;">
            <div class="preformattedContent panelContent"><pre xml:space="preserve">sudo datical-upgrade&#160;</pre>
            </div>
        </div>
        <p>The script does the following:</p>
        <ol>
            <li>Checks for newer versions of each service</li>
            <li>Updates services with new versions from the .part files placed in <code>/opt/datical/install-files</code></li>
            <li>Stops all services</li>
            <li>Starts all services</li>
        </ol>
        <p><strong>Notes</strong>
        </p>
        <ul>
            <li>The command prompt returns before the services restart is complete.&#160;</li>
            <li>
                <p class="auto-cursor-target">To monitor progress, use the following command.&#160;</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">datical-control services watch</pre>
                    </div>
                </div>
            </li>
            <li>Datical is not available until all services reach a state of <strong>running</strong>.&#160;.&#160;</li>
            <li>The old Docker images for the services are not removed.&#160;</li>
        </ul>
        <h1 id="UpdatingaServerorVMfromv5.6.1-"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828220/image2018-12-4_11-34-6.png?version=1&amp;modificationDate=1569859157973&amp;cacheVersion=1&amp;api=v2&amp;width=670&amp;height=250" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828220/image2018-12-4_11-34-6.png?version=1&amp;modificationDate=1569859157973&amp;cacheVersion=1&amp;api=v2&amp;width=1108&amp;height=413 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896828220/image2018-12-4_11-34-6.png?version=1&amp;modificationDate=1569859157973&amp;cacheVersion=1&amp;api=v2&amp;width=670&amp;height=250 1x" /></span>
        </h1>
        <p>
            <br />
        </p>
        <h1 id="UpdatingaServerorVMfromv5.6.1-VerifytheUpgrade">Verify the Upgrade</h1>
        <ol>
            <li>
                <p class="auto-cursor-target">Verify the version. The following command should show the version for all components.</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">datical-control versions show</pre>
                    </div>
                </div>
            </li>
            <li>
                <p class="auto-cursor-target">Verify that all services are running.&#160;</p>
                <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
                    <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">datical-control services show</pre>
                    </div>
                </div>
            </li>
        </ol>
        <h1 id="UpdatingaServerorVMfromv5.6.1-BackUptheUpgradedDaticalService">Back Up the Upgraded Datical Service</h1>
        <p>On the Datical Service host, run a backup.&#160;&#160;</p>
        <div class="code panel pdl conf-macro output-block" style="border-width: 1px;">
            <div class="codeContent panelContent pdl"><pre class="syntaxhighlighter-pre" xml:space="preserve">datical-control backup all</pre>
            </div>
        </div>
        <h1 id="UpdatingaServerorVMfromv5.6.1-RefreshDaticalServiceandLogon">Refresh Datical Service and Log on</h1>
        <ol>
            <li>Access and log in to Datical Service in a browser, using the virtual image URL.&#160;<ul><li>If DMC was open in your browser when you started the update, refresh the page.</li></ul></li>
            <li>Log in again.&#160;</li>
        </ol>
        <p>
            <br />
        </p>
    </body>
</html>