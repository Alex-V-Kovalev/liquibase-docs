<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title></title>
    </head>
    <body>
        <h1>Component Architecture: Kubernetes and Docker</h1>
        <p />
        <div class="toc-macro client-side-toc-macro  conf-macro output-block">
        </div>
        <p>Datical Service can be deployed in two ways:</p>
        <ul>
            <li>Single-node cluster</li>
            <li>Three-node cluster. Datical Service is installed as a node on three hosts.&#160;</li>
        </ul>
        <h1 id="ComponentArchitecture:KubernetesandDocker-KubernetesandDaticalService">Kubernetes and Datical Service</h1>
        <h2 id="ComponentArchitecture:KubernetesandDocker-Cluster">Cluster</h2>
        <p>Datical Service is installed as a Kubernetes cluster that manages Docker images.&#160;</p>
        <p>You can choose to install Datical Service as a single-node cluster or a three-node cluster. The three-node cluster supports High Availability.&#160;</p>
        <h3 id="ComponentArchitecture:KubernetesandDocker-Single-NodeCluster">Single-Node Cluster</h3>
        <p>Kubernetes manages the pods <em>within the node</em> for each microservice, balancing them and monitoring them to make sure they are available. Kubernetes restarts nodes and moves them as necessary.&#160;</p>
        <p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="600" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/arch_cluster_single_node.jpg?version=1&amp;modificationDate=1569859152651&amp;cacheVersion=1&amp;api=v2&amp;width=600&amp;height=320" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/arch_cluster_single_node.jpg?version=1&amp;modificationDate=1569859152651&amp;cacheVersion=1&amp;api=v2&amp;width=787&amp;height=420 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/arch_cluster_single_node.jpg?version=1&amp;modificationDate=1569859152651&amp;cacheVersion=1&amp;api=v2&amp;width=600&amp;height=320 1x" /></span>
        </p>
        <h3 id="ComponentArchitecture:KubernetesandDocker-Multiple-NodeCluster(HighAvailability)">Multiple-Node Cluster (High Availability)</h3>
        <p>Kubernetes manages pod distribution <em>across all nodes in the cluster</em>. If a node becomes unavailable, pods are redistributed among the remaining nodes.&#160;</p>
        <p>A multi-node cluster provides High Availabiity (HA) functionality.</p>
        <p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="600" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/arch_cluster_multi_node.jpg?version=1&amp;modificationDate=1569859152468&amp;cacheVersion=1&amp;api=v2&amp;width=600&amp;height=320" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/arch_cluster_multi_node.jpg?version=1&amp;modificationDate=1569859152468&amp;cacheVersion=1&amp;api=v2&amp;width=787&amp;height=421 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/arch_cluster_multi_node.jpg?version=1&amp;modificationDate=1569859152468&amp;cacheVersion=1&amp;api=v2&amp;width=600&amp;height=320 1x" /></span>
        </p>
        <p>
            <br />
        </p>
        <h3 id="ComponentArchitecture:KubernetesandDocker-HAResponsetoHostFailure">HA Response to Host Failure</h3>
        <p>If a host containing a node goes down, there is a temporary suspension of operations while Kubernetes responds to the outage:</p>
        <ul>
            <li><strong>Non-redundant</strong> pods are <em>redistributed</em> across the remaining nodes.&#160;</li>
            <li><strong>Redundant</strong> pods are not affected. The redundant pods on the remaining nodes remain available.&#160;</li>
        </ul>
        <h2 id="ComponentArchitecture:KubernetesandDocker-Node">Node</h2>
        <p>Each node contains Kubernetes infrastructure and the Docker images it manages.&#160;The Docker images make up the functional components of Datical Service.</p>
        <h2 id="ComponentArchitecture:KubernetesandDocker-Pod">Pod</h2>
        <p>A pod is a running instance of a microservice. In Datical Service, microservices are implemented by Docker images. Kubernetes manages the pods.&#160;</p>
        <h1 id="ComponentArchitecture:KubernetesandDocker-DockerImages">Docker Images</h1>
        <p>Each Docker image represents a microservice in Datical Service. Kubernetes manages and maintains the availability of microservices on a node or across a multi-node configuration.&#160;</p>
        <p>Collectively the set of Docker images make up the Datical Service <em>web application</em>.&#160;</p>
        <p>
            <br />
        </p>
        <p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" width="800" loading="lazy" src="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/datical_service_architecture_v56.jpg?version=1&amp;modificationDate=1569859152287&amp;cacheVersion=1&amp;api=v2&amp;width=800&amp;height=383" srcset="https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/datical_service_architecture_v56.jpg?version=1&amp;modificationDate=1569859152287&amp;cacheVersion=1&amp;api=v2&amp;width=900&amp;height=431 2x, https://datical-cs.atlassian.net/wiki/download/thumbnails/896828003/datical_service_architecture_v56.jpg?version=1&amp;modificationDate=1569859152287&amp;cacheVersion=1&amp;api=v2&amp;width=800&amp;height=383 1x" /></span>
        </p>
        <h3 id="ComponentArchitecture:KubernetesandDocker-CoreComponents">Core Components</h3>
        <div class="table-wrap">
            <table class="wrapped confluenceTable">
                <colgroup>
                    <col />
                    <col />
                </colgroup>
                <tbody>
                    <tr>
                        <th class="confluenceTh">Microservice</th>
                        <th class="confluenceTh">Description</th>
                    </tr>
                    <tr>
                        <td class="confluenceTd">edge</td>
                        <td class="confluenceTd">
                            <p><span style="color: rgb(33,33,33);">Proxy to other services (HTTP/HTTPS) - 1 pod per node</span>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">keycloak</td>
                        <td class="confluenceTd">
                            <p><span style="color: rgb(33,33,33);">User authentication. Configure Keycloak to integrate with your Active Directory or LDAP authentication service.&#160;</span>
                            </p>
                            <ul>
                                <li><span style="color: rgb(33,33,33);">keycloak - 2 stateful pods per node</span>
                                </li>
                                <li><span style="color: rgb(33,33,33);">keycloak-manager - 1 pod per node</span>
                                </li>
                                <li><span style="color: rgb(33,33,33);">keycloak-user-sync 1 temporary pod per node</span>
                                </li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">users</td>
                        <td class="confluenceTd">
                            <p><span style="color: rgb(33,33,33);">User management service (role assignments) - 1 pod per node</span>
                            </p>
                        </td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">projects</td>
                        <td class="confluenceTd">Datical project application - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">postgresql</td>
                        <td class="confluenceTd">
                            <p>Application database and audit database</p>
                            <ul>
                                <li>postgresql-metrics - Metrics collector for the PostgreSQL used by Prometheus - 1 pod per node</li>
                                <li>postgresql-proxy - Load-balancing and replication proxy - 2 pods per node</li>
                                <li>postgresql-sentinal - High-availability setup and automated failover - 2 pods per node</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">reporting</td>
                        <td class="confluenceTd">Reports on operations and project status from the audit database - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">kibana</td>
                        <td colspan="1" class="confluenceTd">Data visualization - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">ux</td>
                        <td class="confluenceTd">User interface (Deployment Management Console, or DMC) - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">jenkins</td>
                        <td class="confluenceTd">
                            <p><span style="color: rgb(33,33,33);">Includes Datical Automation Client (Datical CLI from Datical DB).&#160;</span><span style="color: rgb(33,33,33);">Runs status, forecast, and deploy operations on the Datical Automation Client. 1 pod per node</span>
                            </p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <h3 id="ComponentArchitecture:KubernetesandDocker-SupportServices">Support Services</h3>
        <p>These services require persisted information, which is used when a pod dies or when pods of the same type share data. The persisted-data management is done by the application rather than Kubernetes.&#160; &#160;</p>
        <div class="table-wrap">
            <table class="wrapped confluenceTable">
                <colgroup>
                    <col />
                    <col />
                </colgroup>
                <tbody>
                    <tr>
                        <th class="confluenceTh">Microservice</th>
                        <th class="confluenceTh">Description</th>
                    </tr>
                    <tr>
                        <td class="confluenceTd">elasticsearch</td>
                        <td class="confluenceTd">Data search - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">etcd</td>
                        <td class="confluenceTd">Key-value store used for cluster coordination and state management - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">keycloak</td>
                        <td class="confluenceTd">Authentication service for Datical Service - 2 pods per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">postgresql</td>
                        <td colspan="1" class="confluenceTd">PostgreSQL server nodes - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">rabbitmq</td>
                        <td colspan="1" class="confluenceTd">Message broker used for inter-component communication - 1 pod per node</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <h1 class="auto-cursor-target" id="ComponentArchitecture:KubernetesandDocker-KubernetesforDaticalService">Kubernetes for Datical Service</h1>
        <p class="auto-cursor-target">Collectively the Kubernetes components and the additions for Datical Service make up the specially configured <em>Kubernetes for Datical Service</em>.</p>
        <h2 class="auto-cursor-target" id="ComponentArchitecture:KubernetesandDocker-KubernetesDaemonServices">Kubernetes Daemon Services</h2>
        <div class="table-wrap">
            <table class="wrapped confluenceTable">
                <colgroup>
                    <col />
                    <col />
                </colgroup>
                <tbody>
                    <tr>
                        <th class="confluenceTh">Service</th>
                        <th class="confluenceTh">Description</th>
                    </tr>
                    <tr>
                        <td class="confluenceTd">prometheus</td>
                        <td class="confluenceTd">
                            <p>Kubernetes and application monitoring and time-series database</p>
                            <ul>
                                <li>prometheus-server - 2 pods per node</li>
                                <li>prometheus-node-exporter - 1 pod per node</li>
                                <li>prometheus-kube-state-metrics - 1 pod per node</li>
                                <li>prometheus-pushgateway - 1 pod per node</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">ingress-nginx-ingres-controller</td>
                        <td class="confluenceTd">External access to Kubernetes cluster services, typically HTTP load balancing, SSL, and virtual hosting - 1 per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">filebeat</td>
                        <td class="confluenceTd">Lightweight shipper to forward and centralize log data - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">logstash</td>
                        <td colspan="1" class="confluenceTd">Collects, parses, and stores log file data - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">weave</td>
                        <td colspan="1" class="confluenceTd">Inter-container virtual network across hosts with auto-discovery and encryption - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">kube-proxy</td>
                        <td colspan="1" class="confluenceTd">TCP, UDP, and SCTP stream. Service cluster IPs and ports, Kubernetes cluster DNS - 1 pod per node</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <h2 class="auto-cursor-target" id="ComponentArchitecture:KubernetesandDocker-KubernetesInfrastructureServices">Kubernetes Infrastructure Services</h2>
        <div class="table-wrap">
            <table class="wrapped confluenceTable">
                <colgroup>
                    <col />
                    <col />
                </colgroup>
                <tbody>
                    <tr>
                        <th class="confluenceTh">Service</th>
                        <th class="confluenceTh">Description</th>
                    </tr>
                    <tr>
                        <td class="confluenceTd">grafana</td>
                        <td class="confluenceTd">Reporting and graphing service - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">heapster</td>
                        <td class="confluenceTd">Docker container resource usage and monitoring - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td class="confluenceTd">kubernetes-dashboard</td>
                        <td class="confluenceTd">Internal dashboard for Kubernetes - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">tiller</td>
                        <td colspan="1" class="confluenceTd">Server for Helm client that manages installations (packages) - 1 pod per node</td>
                    </tr>
                    <tr>
                        <td colspan="1" class="confluenceTd">coredns</td>
                        <td colspan="1" class="confluenceTd">Cluster DNS server - 2 pods per node</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>
            <br />
        </p>
        <p>
            <br />
        </p>
    </body>
</html>