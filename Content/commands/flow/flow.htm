<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title><MadCap:variable name="Heading.Level1" /></title>
        <meta rel="canonical" href="https://docs.liquibase.com/commands/flow/flow.html" />
        <meta name="description" content="Reference information and use cases for the flow command and Flow File." />
    </head>
    <body>
        <h1><code>flow</code>
        </h1>
        <p>
            <MadCap:snippetText src="../../Resources/Snippets/images/.ver_icon_size_pro.flsnp" />
        </p>
        <p>The <code>liquibase flow</code> command  is intended to create portable, platform-independent <MadCap:variable name="General.Liquibase" /> workflows that can run wherever you need them without modification. This includes Jenkins, GitHub actions, a developers desktop, or any other CI/CD support tool.</p>
        <p>Flow allows you to put multiple commands in a single file, called a Flow File, so they can all run sequentially by typing a single command into the CLI.  The <code>flow</code> command  provides the convenience of performing all of the steps in one place. This leads to better repeatability and standardization of the steps in a DevOps pipeline.</p>
        <p>You can modify the Flow File  to update the <MadCap:variable name="General.Liquibase" /> steps specified in each Stage. You only have to update them in the Flow File to bring all jobs up to date. It is necessary to store Flow Files in remote locations or share across teams to enable this flexible behavior.</p>
        <h2>Create a Flow File</h2>
        <p>There are two ways to create a Flow File:</p>
        <ol>
            <li>The Default Flow File method, which runs on H2 by default</li>
            <li><a href="advanced-flow-file.htm">The Existing Project method – advanced</a>
            </li>
        </ol>
        <p>The Flow File is not installed by default, so you must create one. If you create a Flow File without a properties file or a <MadCap:variable name="General.changelog" /> configured, it will fail to run.</p>
        <h3>Default Flow File method</h3>
        <p>This method is for creating an entirely new project.</p>
        <ol>
            <li>Run the <code>liquibase flow</code> command.</li>
            <li>Select option <code>3</code>: Generate a flow file and exit.<br /></li>
            <li>Open the newly created file and review the sections and comments.</li>
        </ol>
        <h3>Validation</h3>
        <p>Once the Flow File is written, you can verify that it works by using the <code>flow validate</code> command. This ensures that the <MadCap:variable name="General.Liquibase" /> commands have all of the parameters necessary to run successfully and the YAML formatting is correct. See the <a href="#Syntax">Syntax</a> section for more information. In the CLI, run this command:</p><pre><code class="language-text">flow validate --flow-file update-status-diff.flow</code></pre>
        <p>If the file fails the validation check, <MadCap:variable name="General.Liquibase" /> will state what command argument(s) were not resolved. You can then review and correct your Flow File and then run the <code>flow validate</code> command again to ensure it is working as expected.</p>
        <h2>Flow File organization</h2>
        <p>The Flow File contains one or more Stages and Actions. Below are definitions of these and a visual aid.</p>
        <p class="center">
            <img src="../../Z_Resources/Images/Diagrams/flowfile-basic.png" />
        </p>
        <p><b>Stages</b> are bundles of related <code>actions</code> in the Flow File. You can add a single action or multiple actions per Stage.</p>
        <p><b>Actions</b> are individual <MadCap:variable name="General.Liquibase" /> or shell commands that execute within <code>stages</code> or <a href="advanced-flow-file.htm"><code>endStage</code></a> as part of the Flow File. Any <MadCap:variable name="General.Liquibase" /> command arguments (abbreviated as <code>cmdArgs</code> in the Flow File) can be placed in any <code>action</code> section, with the exception of the list of global arguments below.</p>
        <h3>Incompatible commands and global arguments</h3>
        <p>You must use the following commands and global arguments in the CLI instead of the Flow File:</p>
        <h4>Commands</h4>
        <ul>
            <li><code>init start-h2</code> – This command locks the console</li>
        </ul>
        <h4>Global arguments</h4>
        <ul>
            <li><code>ARGUMENT_CONVERTER</code>
            </li>
            <li><code>CLASSPATH</code>
            </li>
            <li><code>DEFAULTS_FILE</code>
            </li>
            <li><code>INCLUDE_SYSTEM_CLASSPATH</code>
            </li>
            <li><code>LOG_CHANNELS</code>
            </li>
            <li><code>LOG_FILE</code>
            </li>
            <li><code>LOG_LEVEL</code>
            </li>
            <li><code>MONITOR_PERFORMANCE</code>
            </li>
            <li><code>PROMPT_FOR_NON_LOCAL_DATABASE</code>
            </li>
            <li><code>SEARCHPATH</code>
            </li>
            <li><code>SHOULD_RUN</code>
            </li>
            <li><code>SHOW_BANNER</code>
            </li>
        </ul>
        <h3><a name="Syntax"></a>Syntax</h3>
        <p>The <MadCap:variable name="General.Liquibase" /> Flow File is written in YAML and must be formatted properly. As you can see in the below Flow File example, the <code>cmdArgs</code> section has all command arguments between curly braces and separated by commas.</p>
        <p>All command arguments are formatted in the following way:</p><pre xml:space="preserve"><code class="language-text">cmdArgs: {argument: value, snapshot-format: JSON}</code></pre>
        <p>This example Flow File is the simplest scenario in which only <code>cmdArgs</code> are specified in the Actions. For this example to run, a <code><MadCap:variable name="General.liquiPropFile" /></code> file with <code>url</code>, <code>username</code>, and <code>password</code> must be available. The <code><MadCap:variable name="General.liquiPropFile" /></code> file should be in the same directory as the flow file. Additionally, the user will need a <MadCap:variable name="General.changelog" /> file.</p>
        <h3>Flow File example</h3>
        <MadCap:codeSnippet>
            <MadCap:codeSnippetCopyButton />
            <MadCap:codeSnippetBody MadCap:useLineNumbers="True" MadCap:lineNumberStart="1" MadCap:continue="False" xml:space="preserve" style="mc-code-lang: JavaScript;">## Note: Any command which fails in any stage below result in the command stopping, and endStage being run.
## A flow file can have one or more stages, each with multiple "actions", 
## or your flow file can have multiple stages with fewer actions in each stage.

stages:

  ## The first stage of actions. 
  Default:
        
    actions:
      #
      # Quality Checks for changelog
      #
      - type: liquibase
        command: checks run
        cmdArgs: {checks-scope: changelog}
      #
      # Run the update
      #
      - type: liquibase
        command: update
          
      #
      # Quality Checks for database
      #
      - type: liquibase
        command: checks run
        cmdArgs: {checks-scope: database}

## The endStage ALWAYS RUNS. 
## So put actions here which you desire to perform whether previous stages' actions succeed or fail.
## If you do not want any actions to ALWAYS RUN, simply delete the endStage from your flow file.

endStage:
  actions:
    - type: liquibase
      command: history</MadCap:codeSnippetBody>
        </MadCap:codeSnippet>
        <h2>Related Videos:</h2>
        <h3>Learn more about Flow in <MadCap:variable name="General.LBPro" /></h3><iframe width="420px" height="315px" src="https://www.youtube.com/embed/QKV_yiRMHjw" class="center"></iframe>
        <h3>Learn how to use Flow files with s3</h3><iframe width="420" height="315" src="https://www.youtube.com/embed/nOv2YK8rfqI" class="center"></iframe>
        <h2>Related links</h2>
        <ul>
            <li>
                <MadCap:xref href="advanced-flow-file.htm">Advanced Flow File</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="if-conditionals.htm">if conditionals</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="shell-commands.htm">Shell Commands</MadCap:xref>
            </li>
            <li>
                <MadCap:xref href="variables.htm">variables and include feature</MadCap:xref>
            </li>
        </ul>
    </body>
</html>